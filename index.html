<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>虎码字根练习</title>
  <style>
    :root {
      --bg1: #fdf6e3;
      --bg2: #eee8d5;
      --ink: #586e75;
      --muted: #839496;
      --accent: #268bd2;
      --accent-2: #2aa198;
      --card: #f7f0e1;
      --line: rgba(88,110,117,0.2);
      --good: #859900;
      --bad: #dc322f;
      --shadow: 0 20px 50px rgba(88,110,117,0.18);
      --glow-1: rgba(38,139,210,0.12);
      --glow-2: rgba(203,75,22,0.1);
      --card-glow-1: rgba(38,139,210,0.14);
      --card-glow-2: rgba(42,161,152,0.12);
      --ui-surface: rgba(253,246,227,0.75);
      --ui-surface-active: #fdf6e3;
      --ui-border: rgba(88,110,117,0.2);
      --ui-text: #839496;
      --ui-text-active: #586e75;
      --ui-shadow: 0 6px 14px rgba(88,110,117,0.18);
      --ui-hover-border: rgba(38,139,210,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(38,139,210,0.16);
      --btn-surface: #fdf6e3;
      --box-surface: #fdf6e3;
      --box-text: #586e75;
      --root-min: 24px;
      --root-vw: 3.5vw;
      --root-max: 44px;
      --box-size: 34px;
      --box-font: 18px;
      --box-size-mobile: 30px;
      --box-font-mobile: 16px;
    }

    body.theme-solarized.theme-dark {
      --bg1: #002b36;
      --bg2: #073642;
      --ink: #eee8d5;
      --muted: #93a1a1;
      --accent: #268bd2;
      --accent-2: #2aa198;
      --card: #0b3944;
      --line: rgba(238,232,213,0.16);
      --good: #859900;
      --bad: #dc322f;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      --glow-1: rgba(38,139,210,0.18);
      --glow-2: rgba(203,75,22,0.16);
      --card-glow-1: rgba(38,139,210,0.2);
      --card-glow-2: rgba(203,75,22,0.18);
      --ui-surface: rgba(7,54,66,0.85);
      --ui-surface-active: #0b3944;
      --ui-border: rgba(147,161,161,0.35);
      --ui-text: #93a1a1;
      --ui-text-active: #eee8d5;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(147,161,161,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #073642;
      --box-surface: #586e75;
      --box-text: #fdf6e3;
    }

    body.theme-nord {
      --bg1: #eceff4;
      --bg2: #e5e9f0;
      --ink: #2e3440;
      --muted: #4c566a;
      --accent: #5e81ac;
      --accent-2: #8fbcbb;
      --card: #f1f3f7;
      --line: rgba(46,52,64,0.16);
      --good: #a3be8c;
      --bad: #bf616a;
      --shadow: 0 20px 50px rgba(46,52,64,0.18);
      --glow-1: rgba(94,129,172,0.16);
      --glow-2: rgba(136,192,208,0.12);
      --card-glow-1: rgba(94,129,172,0.16);
      --card-glow-2: rgba(143,188,187,0.12);
      --ui-surface: rgba(236,239,244,0.8);
      --ui-surface-active: #eceff4;
      --ui-border: rgba(46,52,64,0.16);
      --ui-text: #4c566a;
      --ui-text-active: #2e3440;
      --ui-shadow: 0 6px 14px rgba(46,52,64,0.18);
      --ui-hover-border: rgba(94,129,172,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(46,52,64,0.18);
      --btn-surface: #eceff4;
      --box-surface: #eceff4;
      --box-text: #2e3440;
    }

    body.theme-nord.theme-dark {
      --bg1: #2e3440;
      --bg2: #3b4252;
      --ink: #e5e9f0;
      --muted: #d8dee9;
      --accent: #88c0d0;
      --accent-2: #8fbcbb;
      --card: #434c5e;
      --line: rgba(236,239,244,0.14);
      --good: #a3be8c;
      --bad: #bf616a;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
      --glow-1: rgba(136,192,208,0.18);
      --glow-2: rgba(143,188,187,0.16);
      --card-glow-1: rgba(136,192,208,0.2);
      --card-glow-2: rgba(191,97,106,0.16);
      --ui-surface: rgba(67,76,94,0.9);
      --ui-surface-active: #4c566a;
      --ui-border: rgba(236,239,244,0.2);
      --ui-text: #d8dee9;
      --ui-text-active: #eceff4;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(136,192,208,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #4c566a;
      --box-surface: #4c566a;
      --box-text: #eceff4;
    }

    body.theme-catppuccin {
      --bg1: #eff1f5;
      --bg2: #e6e9ef;
      --ink: #4c4f69;
      --muted: #6c6f85;
      --accent: #1e66f5;
      --accent-2: #179299;
      --card: #e6e9ef;
      --line: rgba(76,79,105,0.18);
      --good: #40a02b;
      --bad: #d20f39;
      --shadow: 0 20px 50px rgba(76,79,105,0.18);
      --glow-1: rgba(30,102,245,0.14);
      --glow-2: rgba(220,138,120,0.12);
      --card-glow-1: rgba(30,102,245,0.14);
      --card-glow-2: rgba(23,146,153,0.12);
      --ui-surface: rgba(239,241,245,0.8);
      --ui-surface-active: #eff1f5;
      --ui-border: rgba(76,79,105,0.18);
      --ui-text: #6c6f85;
      --ui-text-active: #4c4f69;
      --ui-shadow: 0 6px 14px rgba(76,79,105,0.18);
      --ui-hover-border: rgba(30,102,245,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(30,102,245,0.16);
      --btn-surface: #eff1f5;
      --box-surface: #eff1f5;
      --box-text: #4c4f69;
    }

    body.theme-catppuccin.theme-dark {
      --bg1: #1e1e2e;
      --bg2: #181825;
      --ink: #cdd6f4;
      --muted: #a6adc8;
      --accent: #89b4fa;
      --accent-2: #94e2d5;
      --card: #313244;
      --line: rgba(205,214,244,0.14);
      --good: #a6e3a1;
      --bad: #f38ba8;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      --glow-1: rgba(137,180,250,0.18);
      --glow-2: rgba(250,179,135,0.16);
      --card-glow-1: rgba(137,180,250,0.2);
      --card-glow-2: rgba(148,226,213,0.16);
      --ui-surface: rgba(49,50,68,0.9);
      --ui-surface-active: #45475a;
      --ui-border: rgba(205,214,244,0.18);
      --ui-text: #a6adc8;
      --ui-text-active: #cdd6f4;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(137,180,250,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #45475a;
      --box-surface: #45475a;
      --box-text: #cdd6f4;
    }

    body.theme-gruvbox {
      --bg1: #fbf1c7;
      --bg2: #ebdbb2;
      --ink: #3c3836;
      --muted: #665c54;
      --accent: #458588;
      --accent-2: #689d6a;
      --card: #f2e5bc;
      --line: rgba(60,56,54,0.2);
      --good: #98971a;
      --bad: #cc241d;
      --shadow: 0 20px 50px rgba(60,56,54,0.18);
      --glow-1: rgba(69,133,136,0.16);
      --glow-2: rgba(214,93,14,0.12);
      --card-glow-1: rgba(69,133,136,0.16);
      --card-glow-2: rgba(104,157,106,0.12);
      --ui-surface: rgba(251,241,199,0.78);
      --ui-surface-active: #fbf1c7;
      --ui-border: rgba(60,56,54,0.2);
      --ui-text: #665c54;
      --ui-text-active: #3c3836;
      --ui-shadow: 0 6px 14px rgba(60,56,54,0.18);
      --ui-hover-border: rgba(69,133,136,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(69,133,136,0.16);
      --btn-surface: #fbf1c7;
      --box-surface: #fbf1c7;
      --box-text: #3c3836;
    }

    body.theme-gruvbox.theme-dark {
      --bg1: #282828;
      --bg2: #3c3836;
      --ink: #ebdbb2;
      --muted: #d5c4a1;
      --accent: #83a598;
      --accent-2: #8ec07c;
      --card: #32302f;
      --line: rgba(235,219,178,0.14);
      --good: #b8bb26;
      --bad: #fb4934;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      --glow-1: rgba(131,165,152,0.18);
      --glow-2: rgba(214,93,14,0.16);
      --card-glow-1: rgba(131,165,152,0.2);
      --card-glow-2: rgba(214,93,14,0.18);
      --ui-surface: rgba(50,48,47,0.9);
      --ui-surface-active: #3c3836;
      --ui-border: rgba(235,219,178,0.18);
      --ui-text: #d5c4a1;
      --ui-text-active: #ebdbb2;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(131,165,152,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #3c3836;
      --box-surface: #3c3836;
      --box-text: #ebdbb2;
    }

    body.theme-tokyonight {
      --bg1: #e1e2e7;
      --bg2: #c4c8da;
      --ink: #3760bf;
      --muted: #6172b0;
      --accent: #2e7de9;
      --accent-2: #1abc9c;
      --card: #d6d7dc;
      --line: rgba(55,96,191,0.2);
      --good: #587539;
      --bad: #f52a65;
      --shadow: 0 20px 50px rgba(55,96,191,0.18);
      --glow-1: rgba(46,125,233,0.16);
      --glow-2: rgba(245,42,101,0.12);
      --card-glow-1: rgba(46,125,233,0.16);
      --card-glow-2: rgba(26,188,156,0.12);
      --ui-surface: rgba(225,226,231,0.78);
      --ui-surface-active: #e1e2e7;
      --ui-border: rgba(55,96,191,0.2);
      --ui-text: #6172b0;
      --ui-text-active: #3760bf;
      --ui-shadow: 0 6px 14px rgba(55,96,191,0.18);
      --ui-hover-border: rgba(46,125,233,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(46,125,233,0.16);
      --btn-surface: #e1e2e7;
      --box-surface: #e1e2e7;
      --box-text: #3760bf;
    }

    body.theme-tokyonight.theme-dark {
      --bg1: #1a1b26;
      --bg2: #24283b;
      --ink: #c0caf5;
      --muted: #a9b1d6;
      --accent: #7aa2f7;
      --accent-2: #7dcfff;
      --card: #2f334d;
      --line: rgba(192,202,245,0.14);
      --good: #9ece6a;
      --bad: #f7768e;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      --glow-1: rgba(122,162,247,0.18);
      --glow-2: rgba(247,118,142,0.14);
      --card-glow-1: rgba(122,162,247,0.2);
      --card-glow-2: rgba(125,207,255,0.16);
      --ui-surface: rgba(47,51,77,0.9);
      --ui-surface-active: #3b4261;
      --ui-border: rgba(192,202,245,0.18);
      --ui-text: #a9b1d6;
      --ui-text-active: #c0caf5;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(122,162,247,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #3b4261;
      --box-surface: #3b4261;
      --box-text: #c0caf5;
    }

    body.theme-rosepine {
      --bg1: #faf4ed;
      --bg2: #f2e9e1;
      --ink: #575279;
      --muted: #6e6a86;
      --accent: #286983;
      --accent-2: #d7827e;
      --card: #fffaf3;
      --line: rgba(87,82,121,0.18);
      --good: #56949f;
      --bad: #b4637a;
      --shadow: 0 20px 50px rgba(87,82,121,0.18);
      --glow-1: rgba(40,105,131,0.14);
      --glow-2: rgba(215,130,126,0.12);
      --card-glow-1: rgba(40,105,131,0.14);
      --card-glow-2: rgba(215,130,126,0.12);
      --ui-surface: rgba(250,244,237,0.8);
      --ui-surface-active: #faf4ed;
      --ui-border: rgba(87,82,121,0.18);
      --ui-text: #6e6a86;
      --ui-text-active: #575279;
      --ui-shadow: 0 6px 14px rgba(87,82,121,0.18);
      --ui-hover-border: rgba(40,105,131,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(40,105,131,0.16);
      --btn-surface: #faf4ed;
      --box-surface: #faf4ed;
      --box-text: #575279;
    }

    body.theme-rosepine.theme-dark {
      --bg1: #232136;
      --bg2: #2a273f;
      --ink: #e0def4;
      --muted: #908caa;
      --accent: #3e8fb0;
      --accent-2: #ea9a97;
      --card: #393552;
      --line: rgba(224,222,244,0.14);
      --good: #9ccfd8;
      --bad: #eb6f92;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
      --glow-1: rgba(62,143,176,0.18);
      --glow-2: rgba(235,111,146,0.16);
      --card-glow-1: rgba(62,143,176,0.2);
      --card-glow-2: rgba(234,154,151,0.16);
      --ui-surface: rgba(57,53,82,0.9);
      --ui-surface-active: #4a4566;
      --ui-border: rgba(224,222,244,0.18);
      --ui-text: #908caa;
      --ui-text-active: #e0def4;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(62,143,176,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #4a4566;
      --box-surface: #4a4566;
      --box-text: #e0def4;
    }

    body.theme-one {
      --bg1: #fafafa;
      --bg2: #f0f0f0;
      --ink: #383a42;
      --muted: #5c6370;
      --accent: #4078f2;
      --accent-2: #56b6c2;
      --card: #ffffff;
      --line: rgba(56,58,66,0.18);
      --good: #50a14f;
      --bad: #e45649;
      --shadow: 0 20px 50px rgba(56,58,66,0.18);
      --glow-1: rgba(64,120,242,0.14);
      --glow-2: rgba(228,86,73,0.12);
      --card-glow-1: rgba(64,120,242,0.14);
      --card-glow-2: rgba(86,182,194,0.12);
      --ui-surface: rgba(250,250,250,0.8);
      --ui-surface-active: #fafafa;
      --ui-border: rgba(56,58,66,0.18);
      --ui-text: #5c6370;
      --ui-text-active: #383a42;
      --ui-shadow: 0 6px 14px rgba(56,58,66,0.18);
      --ui-hover-border: rgba(64,120,242,0.45);
      --ui-hover-shadow: 0 6px 14px rgba(64,120,242,0.16);
      --btn-surface: #fafafa;
      --box-surface: #fafafa;
      --box-text: #383a42;
    }

    body.theme-one.theme-dark {
      --bg1: #282c34;
      --bg2: #21252b;
      --ink: #abb2bf;
      --muted: #7f848e;
      --accent: #61afef;
      --accent-2: #56b6c2;
      --card: #2c313c;
      --line: rgba(171,178,191,0.14);
      --good: #98c379;
      --bad: #e06c75;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      --glow-1: rgba(97,175,239,0.18);
      --glow-2: rgba(224,108,117,0.16);
      --card-glow-1: rgba(97,175,239,0.2);
      --card-glow-2: rgba(86,182,194,0.16);
      --ui-surface: rgba(44,49,60,0.9);
      --ui-surface-active: #3a404c;
      --ui-border: rgba(171,178,191,0.18);
      --ui-text: #7f848e;
      --ui-text-active: #abb2bf;
      --ui-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --ui-hover-border: rgba(97,175,239,0.55);
      --ui-hover-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
      --btn-surface: #3a404c;
      --box-surface: #3a404c;
      --box-text: #abb2bf;
    }

    @font-face {
      font-family: "PdfSimSun";
      src: url("./fonts/BAAAAA_SimSun.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfSimSunExtB";
      src: url("./fonts/HAAAAA_SimSun-ExtB.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfConsolas";
      src: url("./fonts/CAAAAA_Consolas.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfTumanPUA";
      src: url("./fonts/DAAAAA_TumanPUA.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfLXGWWenKai";
      src: url("./fonts/AAAAAA_LXGWWenKaiGBScreenR.ttf") format("truetype");
      font-display: swap;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 10% -10%, var(--glow-1) 0%, transparent 60%),
                  radial-gradient(900px 900px at 110% 10%, var(--glow-2) 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height: 100vh;
      font-family: "Source Han Sans SC", "Microsoft YaHei", "PingFang SC", "Heiti SC", sans-serif;
      display: grid;
      place-items: center;
      padding: 28px;
    }

    body.theme-dark {
      color-scheme: dark;
    }

    body.cursor-hidden,
    body.cursor-hidden * {
      cursor: none !important;
    }

    .app {
      width: min(980px, 95vw);
      display: grid;
      gap: 20px;
      transform: translateY(-48px) scale(1.15);
      transform-origin: top center;
    }

    header {
      display: grid;
      gap: 6px;
    }
    .title {
      font-family: "Source Han Sans SC", "Microsoft YaHei", "PingFang SC", "Heiti SC", "Noto Sans CJK SC", sans-serif;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: 0.05em;
      font-weight: 500;
      font-synthesis: none;
    }
    .subtitle {
      color: var(--muted);
      font-size: 14px;
    }

    .top-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      color: var(--muted);
      font-size: 18px;
    }

    .side-controls {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      transition: opacity 160ms ease, transform 160ms ease;
    }

    .learning-mode .stat-attempts,
    .learning-mode .stat-correct,
    .learning-mode .stat-accuracy {
      display: none;
    }

    .stat-wrong {
      display: none;
    }

    .practice-wrong .stat-wrong {
      display: flex;
    }

    .practice-wrong .stat-accuracy,
    .practice-wrong .stat-progress,
    .practice-wrong .stat-crown {
      display: none;
    }

    .stat-crown {
      margin-top: 2px;
      font-size: 18px;
      line-height: 1;
      color: var(--accent);
      flex-basis: 100%;
    }

    .stat-crown.is-empty {
      display: none;
    }

    .stat-timer {
      flex-basis: 100%;
      margin-top: 2px;
    }

    .stat strong {
      color: var(--ink);
    }

    .controls {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      margin-left: auto;
    }

    .mode-switch {
      display: inline-flex;
      gap: 4px;
      padding: 3px;
      border-radius: 999px;
      border: 1px solid var(--ui-border);
      background: var(--ui-surface);
    }

    .mode-btn {
      border: none;
      background: transparent;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--ui-text);
      cursor: pointer;
      transition: color 120ms ease, background-color 120ms ease, box-shadow 120ms ease;
    }

    .mode-btn.is-active {
      color: var(--ui-text-active);
      background: var(--ui-surface-active);
      box-shadow: var(--ui-shadow);
    }

    .size-controls {
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .size-btn {
      border: 1px solid var(--ui-border);
      background: var(--btn-surface);
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 12px;
      color: var(--ui-text-active);
      cursor: pointer;
      transition: border-color 120ms ease, transform 120ms ease, box-shadow 120ms ease;
    }
    .size-btn:hover {
      border-color: var(--ui-hover-border);
      box-shadow: var(--ui-hover-shadow);
      transform: translateY(-1px);
    }
    .size-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .palette-select select {
      border: 1px solid var(--ui-border);
      background: var(--btn-surface);
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 12px;
      color: var(--ui-text-active);
      cursor: pointer;
    }


    .footer {
      color: var(--muted);
      font-size: 12px;
      display: grid;
      gap: 8px;
      z-index: 1;
    }

    .footer-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .footer-hint {
      letter-spacing: 0.04em;
    }

    .footer-row--legal {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    .footer-center {
      justify-self: center;
      text-align: center;
    }

    .footer-right {
      justify-self: end;
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }

    .footer-link {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: color 120ms ease, border-color 120ms ease;
    }

    .footer-link:hover {
      color: var(--accent);
      border-color: var(--accent);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 26px 20px 20px;
      min-height: 260px;
      display: grid;
      gap: 4px;
      align-content: center;
      position: relative;
      overflow: hidden;
      animation: floatIn 600ms ease-out;
      justify-items: center;
      text-align: center;
    }

    .card::before {
      content: "";
      position: absolute;
      width: 260px;
      height: 260px;
      background: conic-gradient(from 140deg, var(--card-glow-1), var(--card-glow-2), var(--card-glow-1));
      border-radius: 50%;
      top: -120px;
      right: -120px;
      filter: blur(2px);
      z-index: 0;
    }

    body.theme-dark .card::before {
      background: conic-gradient(from 140deg, var(--card-glow-1), var(--card-glow-2), var(--card-glow-1));
    }

    .ui-half .footer,
    .ui-full .footer {
      visibility: hidden;
      pointer-events: none;
    }

    .ui-half header .title,
    .ui-full header .title,
    .ui-half header .controls,
    .ui-full header .controls {
      visibility: hidden;
      pointer-events: none;
    }

    .ui-half .side-controls,
    .ui-full .side-controls {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-4px);
    }

    .ui-half .top-meta:hover .side-controls,
    .ui-full .top-meta:hover .side-controls {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .ui-full .card-meta {
      display: none;
    }

    .ui-full .card {
      background: transparent;
      border-color: transparent;
      box-shadow: none;
    }

    .ui-full .card::before {
      content: none;
    }

    .card-meta {
      position: absolute;
      top: 14px;
      left: 16px;
      right: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
      z-index: 2;
      text-align: left;
      pointer-events: none;
    }

    .card-meta .stat,
    .card-meta .status {
      font-size: 12px;
      min-height: auto;
    }

    .root-box {
      z-index: 1;
      display: grid;
      gap: 8px;
    }

    .root-label {
      color: var(--muted);
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .root-char {
      font-family: "PdfTumanPUA", "PdfSimSunExtB", "PdfSimSun", serif;
      font-size: clamp(var(--root-min), var(--root-vw), var(--root-max));
      line-height: 1;
      padding: 0;
    }

    .input-area {
      display: grid;
      gap: 10px;
      z-index: 1;
    }

    .input-label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .input-wrap {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 2px;
      cursor: default;
    }
    .input-wrap.is-error .code-box {
      border-color: var(--bad);
      color: var(--bad);
      background: rgba(182,69,43,0.06);
      box-shadow: inset 0 0 0 1px rgba(182,69,43,0.2);
    }

    .code-input {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      background: transparent;
      opacity: 0;
      caret-color: transparent;
      color: transparent;
      cursor: default;
    }

    .code-boxes {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .code-box {
      width: var(--box-size);
      height: var(--box-size);
      border-radius: 8px;
      border: 1px solid var(--ui-border);
      background: var(--box-surface);
      display: grid;
      place-items: center;
      font-family: "PdfConsolas", "Consolas", "SFMono-Regular", "Menlo", monospace;
      font-size: var(--box-font);
      font-weight: 600;
      text-transform: lowercase;
      color: var(--box-text);
      box-shadow: inset 0 0 0 1px rgba(31,42,36,0.02);
    }

    .reveal {
      min-height: 1em;
      font-family: "PdfConsolas", "Consolas", "SFMono-Regular", "Menlo", monospace;
      font-size: 22px;
      letter-spacing: 0.18em;
      color: var(--bad);
      opacity: 0;
      transform: translateY(-4px);
      transition: opacity 140ms ease, transform 140ms ease;
      z-index: 1;
      line-height: 1;
    }
    .reveal.is-show {
      opacity: 1;
      transform: translateY(0);
    }

    .status {
      font-size: 14px;
      color: var(--muted);
      min-height: 20px;
    }
    .status[data-state="good"] {
      color: var(--good);
    }
    .status[data-state="bad"] {
      color: var(--bad);
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
      z-index: 1;
    }
    .meta strong {
      color: var(--ink);
    }

    .tag {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(212,139,59,0.16);
      color: #8a4f12;
      border: 1px solid rgba(212,139,59,0.35);
      font-size: 12px;
      letter-spacing: 0.04em;
    }

    .shake {
      animation: shake 260ms ease-in-out;
    }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    @media (max-width: 600px) {
      .card { padding: 22px 16px; }
      .top-meta { gap: 10px; }
      .side-controls { gap: 8px; }
      .code-box { width: var(--box-size-mobile); height: var(--box-size-mobile); font-size: var(--box-font-mobile); }
      .footer-row--legal {
        grid-template-columns: 1fr;
        justify-items: center;
      }
      .footer-right {
        justify-self: center;
      }
    }
  </style>
</head>
<body class="theme-solarized">
  <div class="app">
    <header>
      <div class="title">虎码字根练习</div>
      <div class="top-meta">
        <div class="side-controls">
          <div class="size-controls">
            <button class="size-btn" id="sizeDown" type="button" aria-label="缩小">小</button>
            <button class="size-btn" id="sizeUp" type="button" aria-label="放大">大</button>
          </div>
          <div class="mode-switch" role="group" aria-label="主题">
            <button class="mode-btn is-active" id="themeLight" type="button" aria-pressed="true">白</button>
            <button class="mode-btn" id="themeDark" type="button" aria-pressed="false">黑</button>
          </div>
          <label class="palette-select" aria-label="配色">
            <select id="paletteSelect" aria-label="配色">
              <option value="auto">Auto</option>
              <option value="one">One</option>
              <option value="solarized">Solarized</option>
              <option value="nord">Nord</option>
              <option value="catppuccin">Catppuccin</option>
              <option value="gruvbox">Gruvbox</option>
              <option value="tokyonight">Tokyo</option>
              <option value="rosepine">Rose</option>
            </select>
          </label>
          <div class="mode-switch" role="group" aria-label="界面显示">
            <button class="mode-btn is-active" id="uiShow" type="button" aria-pressed="true">不隐</button>
            <button class="mode-btn" id="uiHalf" type="button" aria-pressed="false">半隐</button>
            <button class="mode-btn" id="uiFull" type="button" aria-pressed="false">全隐</button>
          </div>
        </div>
        <div class="controls">
          <div class="mode-switch" role="group" aria-label="字根模式">
            <button class="mode-btn is-active" id="modeAll" type="button" aria-pressed="true">全字根</button>
            <button class="mode-btn" id="modeMerged" type="button" aria-pressed="false">归并字根</button>
          </div>
          <div class="mode-switch" role="group" aria-label="练习模式">
            <button class="mode-btn" id="reviewLearn" type="button" aria-pressed="false">学习</button>
            <button class="mode-btn is-active" id="reviewOff" type="button" aria-pressed="true">普通</button>
            <button class="mode-btn" id="reviewOn" type="button" aria-pressed="false">复习</button>
            <button class="mode-btn" id="reviewFollow" type="button" aria-pressed="false">跟打</button>
            <button class="mode-btn" id="reviewWrong" type="button" aria-pressed="false">错题</button>
          </div>
        </div>
      </div>
    </header>

    <section class="card" id="card">
      <div class="card-meta">
        <div class="stat stat-accuracy">准确率：<strong id="accuracy">0%</strong></div>
        <div class="stat stat-progress">进度：<strong id="progressInfo">0/0</strong></div>
        <div class="stat stat-crown is-empty" id="roundCrown"></div>
        <div class="stat stat-timer">计时：<strong id="timer">00:00</strong></div>
        <div class="stat stat-wrong">错题进度：<strong id="wrongProgress">0/0</strong></div>
      </div>
      <div class="root-char" id="rootChar">?</div>
      <div class="reveal" id="reveal" aria-live="polite"></div>

      <div class="input-wrap" id="inputWrap">
        <input class="code-input" id="codeInput" type="text" inputmode="latin" autocomplete="off" autocapitalize="off" spellcheck="false" maxlength="2" />
        <div class="code-boxes" id="codeBoxes" aria-hidden="true">
          <div class="code-box" data-pos="0"></div>
          <div class="code-box" data-pos="1"></div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-row footer-row--legal">
        <span aria-hidden="true"></span>
        <span class="footer-center">© 2026 虎码字根练习　备案号：待填写</span>
        <span class="footer-right">
          <a class="footer-link" href="https://www.tiger-code.com/" target="_blank" rel="noopener noreferrer">虎码</a>
          <a class="footer-link" href="https://github.com/Wu-HZ/tiger-code-exercise" target="_blank" rel="noopener noreferrer">GitHub</a>
        </span>
      </div>
    </footer>
  </div>

  <script>
    const ROOTS = [{"root": "疒", "code": "ab"}, {"root": "丁", "code": "ad"}, {"root": "㇆", "code": "ae"}, {"root": "乛", "code": "ae"}, {"root": "", "code": "ae"}, {"root": "⺄", "code": "ae"}, {"root": "㇗", "code": "ae"}, {"root": "乚", "code": "ae"}, {"root": "ヿ", "code": "ae"}, {"root": "ㄋ", "code": "ae"}, {"root": "ㄅ", "code": "ae"}, {"root": "", "code": "ae"}, {"root": "丰", "code": "af"}, {"root": "", "code": "af"}, {"root": "龶", "code": "af"}, {"root": "", "code": "af"}, {"root": "缶", "code": "af"}, {"root": "", "code": "af"}, {"root": "鬼", "code": "ag"}, {"root": "乙", "code": "ai"}, {"root": "六", "code": "al"}, {"root": "耒", "code": "al"}, {"root": "门", "code": "am"}, {"root": "皿", "code": "am"}, {"root": "片", "code": "ap"}, {"root": "爿", "code": "ap"}, {"root": "丬", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "舌", "code": "as"}, {"root": "", "code": "as"}, {"root": "未", "code": "aw"}, {"root": "弓", "code": "bg"}, {"root": "乂", "code": "bi"}, {"root": "㐅", "code": "bi"}, {"root": "", "code": "bi"}, {"root": "彐", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "彑", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "", "code": "bk"}, {"root": "", "code": "bk"}, {"root": "卵", "code": "bl"}, {"root": "卯", "code": "bm"}, {"root": "", "code": "bm"}, {"root": "面", "code": "bm"}, {"root": "女", "code": "bn"}, {"root": "氏", "code": "bs"}, {"root": "聿", "code": "bv"}, {"root": "肀", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "云", "code": "by"}, {"root": "", "code": "by"}, {"root": "不", "code": "cb"}, {"root": "虫", "code": "cc"}, {"root": "", "code": "cc"}, {"root": "飞", "code": "cf"}, {"root": "古", "code": "cg"}, {"root": "火", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "灬", "code": "ch"}, {"root": "支", "code": "ci"}, {"root": "及", "code": "cj"}, {"root": "尸", "code": "cs"}, {"root": "", "code": "cs"}, {"root": "", "code": "cs"}, {"root": "业", "code": "cy"}, {"root": "口", "code": "dk"}, {"root": "〇", "code": "dk"}, {"root": "里", "code": "dl"}, {"root": "民", "code": "dm"}, {"root": "黾", "code": "dm"}, {"root": "无", "code": "du"}, {"root": "旡", "code": "du"}, {"root": "由", "code": "dy"}, {"root": "干", "code": "eg"}, {"root": "见", "code": "ej"}, {"root": "木", "code": "em"}, {"root": "朩", "code": "em"}, {"root": "欠", "code": "eq"}, {"root": "彡", "code": "es"}, {"root": "", "code": "es"}, {"root": "𠂉", "code": "et"}, {"root": "穴", "code": "ex"}, {"root": "", "code": "ex"}, {"root": "也", "code": "ey"}, {"root": "㡀", "code": "fb"}, {"root": "辰", "code": "fc"}, {"root": "骨", "code": "fg"}, {"root": "冎", "code": "fg"}, {"root": "一", "code": "fi"}, {"root": "㇀", "code": "fi"}, {"root": "且", "code": "fq"}, {"root": "示", "code": "fs"}, {"root": "礻", "code": "fs"}, {"root": "亡", "code": "fw"}, {"root": "亾", "code": "fw"}, {"root": "歹", "code": "gd"}, {"root": "歺", "code": "gd"}, {"root": "", "code": "gd"}, {"root": "高", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "句", "code": "gj"}, {"root": "丨", "code": "gs"}, {"root": "亅", "code": "gs"}, {"root": "士", "code": "gs"}, {"root": "土", "code": "gt"}, {"root": "韦", "code": "gw"}, {"root": "羊", "code": "gy"}, {"root": "⺷", "code": "gy"}, {"root": "⺶", "code": "gy"}, {"root": "", "code": "gy"}, {"root": "芈", "code": "gy"}, {"root": "八", "code": "hb"}, {"root": "丷", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "䒑", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "癶", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "夫", "code": "hf"}, {"root": "谷", "code": "hg"}, {"root": "", "code": "hg"}, {"root": "子", "code": "hi"}, {"root": "夂", "code": "hi"}, {"root": "夊", "code": "hi"}, {"root": "", "code": "hi"}, {"root": "攵", "code": "hp"}, {"root": "攴", "code": "hp"}, {"root": "壴", "code": "hu"}, {"root": "", "code": "hu"}, {"root": "心", "code": "hx"}, {"root": "忄", "code": "hx"}, {"root": "⺗", "code": "hx"}, {"root": "册", "code": "ic"}, {"root": "", "code": "ic"}, {"root": "", "code": "ic"}, {"root": "丶", "code": "id"}, {"root": "㇏", "code": "id"}, {"root": "艮", "code": "ig"}, {"root": "", "code": "ig"}, {"root": "丩", "code": "ij"}, {"root": "立", "code": "il"}, {"root": "", "code": "il"}, {"root": "舟", "code": "io"}, {"root": "糸", "code": "is"}, {"root": "纟", "code": "is"}, {"root": "予", "code": "iv"}, {"root": "乡", "code": "ix"}, {"root": "幺", "code": "iy"}, {"root": "斗", "code": "jd"}, {"root": "亼", "code": "ji"}, {"root": "亽", "code": "ji"}, {"root": "仑", "code": "jl"}, {"root": "侖", "code": "jl"}, {"root": "人", "code": "jr"}, {"root": "亻", "code": "jr"}, {"root": "豕", "code": "js"}, {"root": "", "code": "js"}, {"root": "入", "code": "ju"}, {"root": "寸", "code": "kc"}, {"root": "亥", "code": "kh"}, {"root": "㠯", "code": "ki"}, {"root": "九", "code": "kj"}, {"root": "母", "code": "km"}, {"root": "水", "code": "ks"}, {"root": "氵", "code": "ks"}, {"root": "⺍", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "氺", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "厶", "code": "ks"}, {"root": "龴", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "毋", "code": "ku"}, {"root": "毌", "code": "ku"}, {"root": "艹", "code": "lc"}, {"root": "廾", "code": "lc"}, {"root": "丌", "code": "lc"}, {"root": "艸", "code": "lc"}, {"root": "齿", "code": "lc"}, {"root": "而", "code": "le"}, {"root": "方", "code": "lf"}, {"root": "廿", "code": "ln"}, {"root": "龷", "code": "ln"}, {"root": "千", "code": "lq"}, {"root": "生", "code": "ls"}, {"root": "卅", "code": "ls"}, {"root": "", "code": "ls"}, {"root": "夕", "code": "lx"}, {"root": "卌", "code": "lx"}, {"root": "牙", "code": "ly"}, {"root": "巴", "code": "mb"}, {"root": "大", "code": "md"}, {"root": "二", "code": "me"}, {"root": "光", "code": "mg"}, {"root": "", "code": "mg"}, {"root": "户", "code": "mh"}, {"root": "", "code": "mh"}, {"root": "豸", "code": "mi"}, {"root": "冂", "code": "mk"}, {"root": "凵", "code": "mk"}, {"root": "⺆", "code": "mk"}, {"root": "", "code": "mk"}, {"root": "", "code": "mk"}, {"root": "两", "code": "ml"}, {"root": "犬", "code": "mq"}, {"root": "犭", "code": "mq"}, {"root": "石", "code": "ms"}, {"root": "甫", "code": "nf"}, {"root": "鬲", "code": "ng"}, {"root": "黄", "code": "nh"}, {"root": "勹", "code": "nk"}, {"root": "匚", "code": "nk"}, {"root": "", "code": "nk"}, {"root": "コ", "code": "nk"}, {"root": "马", "code": "nm"}, {"root": "十", "code": "ns"}, {"root": "𠂇", "code": "ns"}, {"root": "", "code": "ns"}, {"root": "戊", "code": "nu"}, {"root": "", "code": "nu"}, {"root": "戉", "code": "nu"}, {"root": "王", "code": "nw"}, {"root": "辛", "code": "nx"}, {"root": "贝", "code": "ob"}, {"root": "川", "code": "oc"}, {"root": "", "code": "oc"}, {"root": "", "code": "oc"}, {"root": "巛", "code": "oc"}, {"root": "巜", "code": "oc"}, {"root": "自", "code": "oi"}, {"root": "几", "code": "oj"}, {"root": "⺇", "code": "oj"}, {"root": "", "code": "oj"}, {"root": "日", "code": "or"}, {"root": "曰", "code": "or"}, {"root": "⺜", "code": "or"}, {"root": "", "code": "or"}, {"root": "矢", "code": "os"}, {"root": "尤", "code": "oy"}, {"root": "尢", "code": "oy"}, {"root": "长", "code": "pc"}, {"root": "镸", "code": "pc"}, {"root": "刀", "code": "pd"}, {"root": "〢", "code": "pd"}, {"root": "刂", "code": "pd"}, {"root": "リ", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "儿", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "戈", "code": "pg"}, {"root": "", "code": "pg"}, {"root": "黑", "code": "ph"}, {"root": "", "code": "ph"}, {"root": "弋", "code": "pi"}, {"root": "臼", "code": "pj"}, {"root": "", "code": "pj"}, {"root": "米", "code": "pm"}, {"root": "", "code": "pm"}, {"root": "鼠", "code": "ps"}, {"root": "", "code": "ps"}, {"root": "足", "code": "pu"}, {"root": "⻊", "code": "pu"}, {"root": "行", "code": "px"}, {"root": "走", "code": "pz"}, {"root": "臣", "code": "qc"}, {"root": "", "code": "qc"}, {"root": "耳", "code": "qe"}, {"root": "井", "code": "qj"}, {"root": "", "code": "qj"}, {"root": "老", "code": "ql"}, {"root": "耂", "code": "ql"}, {"root": "目", "code": "qm"}, {"root": "", "code": "qm"}, {"root": "牛", "code": "qn"}, {"root": "牜", "code": "qn"}, {"root": "⺧", "code": "qn"}, {"root": "齐", "code": "qq"}, {"root": "食", "code": "qs"}, {"root": "饣", "code": "qs"}, {"root": "田", "code": "qt"}, {"root": "非", "code": "rf"}, {"root": "之", "code": "ri"}, {"root": "巾", "code": "rj"}, {"root": "囗（框）", "code": "rk"}, {"root": "了", "code": "rl"}, {"root": "皮", "code": "rp"}, {"root": "七", "code": "rq"}, {"root": "", "code": "rq"}, {"root": "", "code": "rq"}, {"root": "殳", "code": "rs"}, {"root": "竹", "code": "ru"}, {"root": "⺮", "code": "ru"}, {"root": "", "code": "ru"}, {"root": "瓦", "code": "rw"}, {"root": "又", "code": "ry"}, {"root": "ス", "code": "ry"}, {"root": "屮", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "各", "code": "sg"}, {"root": "止", "code": "si"}, {"root": "", "code": "si"}, {"root": "", "code": "si"}, {"root": "龰", "code": "si"}, {"root": "甲", "code": "sj"}, {"root": "力", "code": "sl"}, {"root": "尚", "code": "ss"}, {"root": "", "code": "ss"}, {"root": "龸", "code": "ss"}, {"root": "言", "code": "sy"}, {"root": "讠", "code": "sy"}, {"root": "阝", "code": "te"}, {"root": "弗", "code": "tf"}, {"root": "𢎨", "code": "tf"}, {"root": "𠂔", "code": "tf"}, {"root": "革", "code": "tg"}, {"root": "衣", "code": "ti"}, {"root": "衤", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "斤", "code": "tj"}, {"root": "", "code": "tj"}, {"root": "龙", "code": "tl"}, {"root": "丿", "code": "tp"}, {"root": "㇒", "code": "tp"}, {"root": "疋", "code": "ts"}, {"root": "𤴓", "code": "ts"}, {"root": "⺪", "code": "ts"}, {"root": "三", "code": "ts"}, {"root": "雨", "code": "tv"}, {"root": "⻗", "code": "tv"}, {"root": "用", "code": "ty"}, {"root": "", "code": "ty"}, {"root": "白", "code": "ub"}, {"root": "辶", "code": "uc"}, {"root": "工", "code": "ug"}, {"root": "隹", "code": "ui"}, {"root": "手", "code": "us"}, {"root": "扌", "code": "us"}, {"root": "龵", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "廴", "code": "uy"}, {"root": "匕", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "已", "code": "vi"}, {"root": "己", "code": "vj"}, {"root": "", "code": "vj"}, {"root": "㐄", "code": "vk"}, {"root": "", "code": "vk"}, {"root": "毛", "code": "vm"}, {"root": "乃", "code": "vn"}, {"root": "", "code": "vn"}, {"root": "气", "code": "vq"}, {"root": "禸", "code": "vr"}, {"root": "⽱", "code": "vr"}, {"root": "山", "code": "vs"}, {"root": "巳", "code": "vs"}, {"root": "文", "code": "vw"}, {"root": "西", "code": "vx"}, {"root": "覀", "code": "vx"}, {"root": "月", "code": "vy"}, {"root": "⺝", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "乍", "code": "wa"}, {"root": "冫", "code": "wb"}, {"root": "", "code": "wb"}, {"root": "⺀", "code": "wb"}, {"root": "彳", "code": "wc"}, {"root": "亍", "code": "wc"}, {"root": "宀", "code": "wg"}, {"root": "冖", "code": "wg"}, {"root": "龟", "code": "wg"}, {"root": "兔", "code": "wt"}, {"root": "", "code": "wt"}, {"root": "五", "code": "wu"}, {"root": "鱼", "code": "wv"}, {"root": "𩵋", "code": "wv"}, {"root": "象", "code": "wx"}, {"root": "页", "code": "wy"}, {"root": "頁", "code": "wy"}, {"root": "", "code": "wy"}, {"root": "", "code": "wy"}, {"root": "厂", "code": "xc"}, {"root": "⺁", "code": "xc"}, {"root": "⺈", "code": "xd"}, {"root": "", "code": "xd"}, {"root": "", "code": "xd"}, {"root": "广", "code": "xg"}, {"root": "禾", "code": "xh"}, {"root": "", "code": "xh"}, {"root": "鹿", "code": "xl"}, {"root": "鸟", "code": "xn"}, {"root": "", "code": "xn"}, {"root": "束", "code": "xs"}, {"root": "乌", "code": "xu"}, {"root": "音", "code": "xy"}, {"root": "爪", "code": "ya"}, {"root": "爫", "code": "ya"}, {"root": "卜", "code": "yb"}, {"root": "⺊", "code": "yb"}, {"root": "车", "code": "yc"}, {"root": "", "code": "yc"}, {"root": "車", "code": "yc"}, {"root": "瓜", "code": "yg"}, {"root": "至", "code": "yi"}, {"root": "曲", "code": "yq"}, {"root": "四", "code": "ys"}, {"root": "罒", "code": "ys"}, {"root": "小", "code": "yx"}, {"root": "⺌", "code": "yx"}, {"root": "", "code": "yx"}, {"root": "𡭔", "code": "yx"}, {"root": "酉", "code": "yy"}, {"root": "豆", "code": "zd"}, {"root": "甘", "code": "zg"}, {"root": "", "code": "zg"}, {"root": "虎", "code": "zh"}, {"root": "虍", "code": "zh"}, {"root": "金", "code": "zj"}, {"root": "钅", "code": "zj"}, {"root": "", "code": "zj"}, {"root": "卩", "code": "zj"}, {"root": "ㄗ", "code": "zj"}, {"root": "⺋", "code": "zj"}, {"root": "", "code": "zj"}, {"root": "可", "code": "zk"}, {"root": "", "code": "zk"}, {"root": "麻", "code": "zm"}, {"root": "身", "code": "zs"}, {"root": "㐆", "code": "zs"}, {"root": "亠", "code": "zt"}, {"root": "羽", "code": "zv"}, {"root": "习", "code": "zx"}];

    const ROOTS_VARIANTS = ROOTS.map(normalizeRootItem);
    const ROOTS_MERGED_RAW = [{"root": "\u7592", "code": "ab"}, {"root": "\u4e01", "code": "ad"}, {"root": "\u31c6 \u4e5b\ue4cc\u2e84\u31d7\u4e5a\u30ff\u310b\u3105\ue4cd", "code": "ae"}, {"root": "\u4e30 \ue415\u9fb6\ue905", "code": "af"}, {"root": "\u7f36 \ue589", "code": "af"}, {"root": "\u9b3c", "code": "ag"}, {"root": "\u4e59", "code": "ai"}, {"root": "\u516d", "code": "al"}, {"root": "\u8012", "code": "al"}, {"root": "\u95e8", "code": "am"}, {"root": "\u76bf", "code": "am"}, {"root": "\u7247 \u723f\u4e2c\ue495\ue407\ue408", "code": "ap"}, {"root": "\u820c \ue429", "code": "as"}, {"root": "\u672a", "code": "aw"}, {"root": "\u5f13", "code": "bg"}, {"root": "\u4e42 \u3405\ue4b6", "code": "bi"}, {"root": "\u5f50 \ue4bd\ue459\u5f51\ue4bc", "code": "bj"}, {"root": "\ue479 \ue478", "code": "bk"}, {"root": "\u5375", "code": "bl"}, {"root": "\u536f \ue580", "code": "bm"}, {"root": "\u9762", "code": "bm"}, {"root": "\u5973", "code": "bn"}, {"root": "\u6c0f", "code": "bs"}, {"root": "\u807f \u8080\ue4c0\ue4c1\ue4bf", "code": "bv"}, {"root": "\u4e91 \ue4b5", "code": "by"}, {"root": "\u4e0d", "code": "cb"}, {"root": "\u866b \ue56b", "code": "cc"}, {"root": "\u98de", "code": "cf"}, {"root": "\u53e4", "code": "cg"}, {"root": "\u706b \ue4aa\ue4a8\ue4a9\u706c", "code": "ch"}, {"root": "\u652f", "code": "ci"}, {"root": "\u53ca", "code": "cj"}, {"root": "\u5c38 \ue42c\ue42a", "code": "cs"}, {"root": "\u4e1a", "code": "cy"}, {"root": "\u53e3 \u3007", "code": "dk"}, {"root": "\u91cc", "code": "dl"}, {"root": "\u6c11", "code": "dm"}, {"root": "\u9efe", "code": "dm"}, {"root": "\u65e0 \u65e1", "code": "du"}, {"root": "\u7531", "code": "dy"}, {"root": "\u5e72", "code": "eg"}, {"root": "\u89c1", "code": "ej"}, {"root": "\u6728 \u6729", "code": "em"}, {"root": "\u6b20", "code": "eq"}, {"root": "\u5f61 \ue4c4", "code": "es"}, {"root": "\ud840\udc89", "code": "et"}, {"root": "\u7a74 \ue400", "code": "ex"}, {"root": "\u4e5f", "code": "ey"}, {"root": "\u3840", "code": "fb"}, {"root": "\u8fb0", "code": "fc"}, {"root": "\u9aa8 \u518e", "code": "fg"}, {"root": "\u4e00 \u31c0", "code": "fi"}, {"root": "\u4e14", "code": "fq"}, {"root": "\u793a \u793b", "code": "fs"}, {"root": "\u4ea1 \u4ebe", "code": "fw"}, {"root": "\u6b79 \u6b7a\ue4dd", "code": "gd"}, {"root": "\u9ad8 \ue440\ue441\ue443", "code": "gg"}, {"root": "\u53e5", "code": "gj"}, {"root": "\u4e28 \u4e85", "code": "gs"}, {"root": "\u58eb", "code": "gs"}, {"root": "\u571f", "code": "gt"}, {"root": "\u97e6", "code": "gw"}, {"root": "\u7f8a \u2eb7\u2eb6\ue5ac\u8288", "code": "gy"}, {"root": "\u516b \u4e37\ue8eb\u4491\ue40e\u7676\ue524", "code": "hb"}, {"root": "\u592b", "code": "hf"}, {"root": "\u8c37 \ue5ad", "code": "hg"}, {"root": "\u5b50", "code": "hi"}, {"root": "\u5902 \u590a\ue8be", "code": "hi"}, {"root": "\u6535 \u6534", "code": "hp"}, {"root": "\u58f4 \ue82d", "code": "hu"}, {"root": "\u5fc3 \u5fc4\u2e97", "code": "hx"}, {"root": "\u518c \ue43a\ue43e", "code": "ic"}, {"root": "\u4e36 \u31cf", "code": "id"}, {"root": "\u826e \ue4d0", "code": "ig"}, {"root": "\u4e29", "code": "ij"}, {"root": "\u7acb \ue446", "code": "il"}, {"root": "\u821f", "code": "io"}, {"root": "\u7cf8 \u7e9f", "code": "is"}, {"root": "\u4e88", "code": "iv"}, {"root": "\u4e61", "code": "ix"}, {"root": "\u5e7a", "code": "iy"}, {"root": "\u6597", "code": "jd"}, {"root": "\u4ebc \u4ebd", "code": "ji"}, {"root": "\u4ed1 \u4f96", "code": "jl"}, {"root": "\u4eba \u4ebb", "code": "jr"}, {"root": "\u8c55 \ue460", "code": "js"}, {"root": "\u5165", "code": "ju"}, {"root": "\u5bf8", "code": "kc"}, {"root": "\u4ea5", "code": "kh"}, {"root": "\u382f", "code": "ki"}, {"root": "\u4e5d", "code": "kj"}, {"root": "\u6bcd", "code": "km"}, {"root": "\u6c34 \u6c35\u2e8d\ue48a\u6c3a\ue48b\ue48c\ue48d", "code": "ks"}, {"root": "\u53b6 \u9fb4\ue433", "code": "ks"}, {"root": "\u6bcb \u6bcc", "code": "ku"}, {"root": "\u8279 \u5efe\u4e0c\u8278", "code": "lc"}, {"root": "\u9f7f", "code": "lc"}, {"root": "\u800c", "code": "le"}, {"root": "\u65b9", "code": "lf"}, {"root": "\u5eff \u9fb7", "code": "ln"}, {"root": "\u5343", "code": "lq"}, {"root": "\u751f", "code": "ls"}, {"root": "\u5345 \ue410", "code": "ls"}, {"root": "\u5915", "code": "lx"}, {"root": "\u534c", "code": "lx"}, {"root": "\u7259", "code": "ly"}, {"root": "\u5df4", "code": "mb"}, {"root": "\u5927", "code": "md"}, {"root": "\u4e8c", "code": "me"}, {"root": "\u5149 \ue856", "code": "mg"}, {"root": "\u6237 \ue405", "code": "mh"}, {"root": "\u8c78", "code": "mi"}, {"root": "\u5182 \u51f5\u2e86\ue452\ue402", "code": "mk"}, {"root": "\u4e24", "code": "ml"}, {"root": "\u72ac \u72ad", "code": "mq"}, {"root": "\u77f3", "code": "ms"}, {"root": "\u752b", "code": "nf"}, {"root": "\u9b32", "code": "ng"}, {"root": "\u9ec4", "code": "nh"}, {"root": "\u52f9", "code": "nk"}, {"root": "\u531a \ue432\u30b3", "code": "nk"}, {"root": "\u9a6c", "code": "nm"}, {"root": "\u5341 \ud840\udc87\ue431", "code": "ns"}, {"root": "\u620a \ue44f\u6209", "code": "nu"}, {"root": "\u738b", "code": "nw"}, {"root": "\u8f9b", "code": "nx"}, {"root": "\u8d1d", "code": "ob"}, {"root": "\u5ddd \ue4e5\ue490\u5ddb\u5ddc", "code": "oc"}, {"root": "\u81ea", "code": "oi"}, {"root": "\u51e0 \u2e87\ue915", "code": "oj"}, {"root": "\u65e5 \u66f0\u2e9c\ue477", "code": "or"}, {"root": "\u77e2", "code": "os"}, {"root": "\u5c24 \u5c22", "code": "oy"}, {"root": "\u957f \u9578", "code": "pc"}, {"root": "\u5200 \u3022\u5202\u30ea\ue449\ue44d\ue44b\ue44c", "code": "pd"}, {"root": "\u513f \ue489\ue80e\ue863", "code": "pe"}, {"root": "\u6208 \ue450", "code": "pg"}, {"root": "\u9ed1 \ue8c3", "code": "ph"}, {"root": "\u5f0b", "code": "pi"}, {"root": "\u81fc \ue4c2", "code": "pj"}, {"root": "\u7c73 \ue5bc", "code": "pm"}, {"root": "\u9f20 \ue462", "code": "ps"}, {"root": "\u8db3 \u2eca", "code": "pu"}, {"root": "\u884c", "code": "px"}, {"root": "\u8d70", "code": "pz"}, {"root": "\u81e3 \ue472", "code": "qc"}, {"root": "\u8033", "code": "qe"}, {"root": "\u4e95 \ue417", "code": "qj"}, {"root": "\u8001 \u8002", "code": "ql"}, {"root": "\u76ee \ue858", "code": "qm"}, {"root": "\u725b \u725c\u2ea7", "code": "qn"}, {"root": "\u9f50", "code": "qq"}, {"root": "\u98df \u9963", "code": "qs"}, {"root": "\u7530", "code": "qt"}, {"root": "\u975e", "code": "rf"}, {"root": "\u4e4b", "code": "ri"}, {"root": "\u5dfe", "code": "rj"}, {"root": "\u56d7(\u6846)", "code": "rk"}, {"root": "\u4e86", "code": "rl"}, {"root": "\u76ae", "code": "rp"}, {"root": "\u4e03 \ue439\ue438", "code": "rq"}, {"root": "\u6bb3", "code": "rs"}, {"root": "\u7af9 \u2eae\ue4a1", "code": "ru"}, {"root": "\u74e6", "code": "rw"}, {"root": "\u53c8 \u30b9", "code": "ry"}, {"root": "\u5c6e \ue413\ue4cf\ue414\ue830", "code": "sc"}, {"root": "\u5404", "code": "sg"}, {"root": "\u6b62 \ue870\ue46f\u9fb0", "code": "si"}, {"root": "\u7532", "code": "sj"}, {"root": "\u529b", "code": "sl"}, {"root": "\u5c1a \ue4a6\u9fb8", "code": "ss"}, {"root": "\u8a00 \u8ba0", "code": "sy"}, {"root": "\u961d", "code": "te"}, {"root": "\u5f17 \ud848\udfa8\ud840\udc94", "code": "tf"}, {"root": "\u9769", "code": "tg"}, {"root": "\u8863 \u8864\ue4c5\ue4c8\ue4c7", "code": "ti"}, {"root": "\u65a4 \ue455", "code": "tj"}, {"root": "\u9f99", "code": "tl"}, {"root": "\u4e3f \u31d2", "code": "tp"}, {"root": "\u758b \ud853\udd13\u2eaa", "code": "ts"}, {"root": "\u4e09", "code": "ts"}, {"root": "\u96e8 \u2ed7", "code": "tv"}, {"root": "\u7528 \ue47c", "code": "ty"}, {"root": "\u767d", "code": "ub"}, {"root": "\u8fb6", "code": "uc"}, {"root": "\u5de5", "code": "ug"}, {"root": "\u96b9", "code": "ui"}, {"root": "\u624b \u624c\u9fb5\ue4e9\ue42f\ue430\ue4ba", "code": "us"}, {"root": "\u5ef4", "code": "uy"}, {"root": "\u5315 \ue498\ue497\ue5c5", "code": "vb"}, {"root": "\u5df2", "code": "vi"}, {"root": "\u5df1 \ue4d5", "code": "vj"}, {"root": "\u3404 \ue46b", "code": "vk"}, {"root": "\u6bdb", "code": "vm"}, {"root": "\u4e43 \ue592", "code": "vn"}, {"root": "\u6c14", "code": "vq"}, {"root": "\u79b8 \u2f71", "code": "vr"}, {"root": "\u5c71", "code": "vs"}, {"root": "\u5df3", "code": "vs"}, {"root": "\u6587", "code": "vw"}, {"root": "\u897f \u8980", "code": "vx"}, {"root": "\u6708 \u2e9d\ue41c\ue422\ue420", "code": "vy"}, {"root": "\u4e4d", "code": "wa"}, {"root": "\u51ab \ue48f\u2e80", "code": "wb"}, {"root": "\u5f73 \u4e8d", "code": "wc"}, {"root": "\u5b80 \u5196", "code": "wg"}, {"root": "\u9f9f", "code": "wg"}, {"root": "\u5154 \ue464", "code": "wt"}, {"root": "\u4e94", "code": "wu"}, {"root": "\u9c7c \ud867\udd4b", "code": "wv"}, {"root": "\u8c61", "code": "wx"}, {"root": "\u9875 \u9801\ue532\ue4de", "code": "wy"}, {"root": "\u5382 \u2e81", "code": "xc"}, {"root": "\u2e88 \ue488\ue4e4", "code": "xd"}, {"root": "\u5e7f", "code": "xg"}, {"root": "\u79be \ue748", "code": "xh"}, {"root": "\u9e7f", "code": "xl"}, {"root": "\u9e1f \ue45e", "code": "xn"}, {"root": "\u675f", "code": "xs"}, {"root": "\u4e4c", "code": "xu"}, {"root": "\u97f3", "code": "xy"}, {"root": "\u722a \u722b", "code": "ya"}, {"root": "\u535c \u2e8a", "code": "yb"}, {"root": "\u8f66 \ue46e\u8eca", "code": "yc"}, {"root": "\u74dc", "code": "yg"}, {"root": "\u81f3", "code": "yi"}, {"root": "\u66f2", "code": "yq"}, {"root": "\u56db \u7f52", "code": "ys"}, {"root": "\u5c0f \u2e8c\ue4b4\ud846\udf54", "code": "yx"}, {"root": "\u9149", "code": "yy"}, {"root": "\u8c46", "code": "zd"}, {"root": "\u7518 \ue499", "code": "zg"}, {"root": "\u864e \u864d", "code": "zh"}, {"root": "\u91d1 \u9485\ue456", "code": "zj"}, {"root": "\u5369 \u3117\u2e8b\ue4d1", "code": "zj"}, {"root": "\u53ef \ue8e0", "code": "zk"}, {"root": "\u9ebb", "code": "zm"}, {"root": "\u8eab \u3406", "code": "zs"}, {"root": "\u4ea0", "code": "zt"}, {"root": "\u7fbd", "code": "zv"}, {"root": "\u4e60", "code": "zx"}];
    const ROOTS_MERGED = ROOTS_MERGED_RAW.map(normalizeRootItem);
    const { mergedToVariants, variantToMerged } = buildRootMappings();

    const rootChar = document.getElementById('rootChar');
    const codeInput = document.getElementById('codeInput');
    const inputWrap = document.getElementById('inputWrap');
    const boxEls = Array.from(document.querySelectorAll('.code-box'));
    const revealEl = document.getElementById('reveal');
    const statusEl = document.getElementById('status');
    const progressEl = document.getElementById('progress');
    const correctEl = document.getElementById('correct');
    const accuracyEl = document.getElementById('accuracy');
    const progressInfoEl = document.getElementById('progressInfo');
    const wrongProgressInfoEl = document.getElementById('wrongProgress');
    const roundCrownEl = document.getElementById('roundCrown');
    const timerEl = document.getElementById('timer');
    const modeAllBtn = document.getElementById('modeAll');
    const modeMergedBtn = document.getElementById('modeMerged');
    const reviewOffBtn = document.getElementById('reviewOff');
    const reviewOnBtn = document.getElementById('reviewOn');
    const reviewLearnBtn = document.getElementById('reviewLearn');
    const reviewFollowBtn = document.getElementById('reviewFollow');
    const reviewWrongBtn = document.getElementById('reviewWrong');
    const uiShowBtn = document.getElementById('uiShow');
    const uiHalfBtn = document.getElementById('uiHalf');
    const uiFullBtn = document.getElementById('uiFull');
    const themeLightBtn = document.getElementById('themeLight');
    const themeDarkBtn = document.getElementById('themeDark');
    const paletteSelect = document.getElementById('paletteSelect');
    const sizeDownBtn = document.getElementById('sizeDown');
    const sizeUpBtn = document.getElementById('sizeUp');

    let order = [];
    let currentIndex = 0;
    let currentItemIndex = 0;
    let currentIsReview = false;
    let total = 0;
    let correct = 0;
    let locked = false;
    let buffer = '';
    let mode = 'all';
    let activeRoots = ROOTS_VARIANTS;
    let practiceMode = 'normal';
    let reviewEnabled = practiceMode !== 'review';
    let learningMode = practiceMode === 'learning';
    let uiMode = 'show';
    let schemeMode = 'light';
    let paletteMode = 'auto';
    let activePalette = 'one';
    let autoPaletteBaseIndex = 0;
    let reviewQueue = [];
    const reviewState = new Map();
    const completedSet = new Set();
    const wrongByMode = { all: new Set(), merged: new Set() };
    let wrongSet = wrongByMode.all;
    const wrongProgressByMode = { all: new Set(), merged: new Set() };
    let wrongProgressSet = wrongProgressByMode.all;
    const roundsByMode = { all: 0, merged: 0 };
    const TIMER_IDLE_MS = 5000;
    const TIMER_TICK_MS = 250;
    let timerRunning = false;
    let timerStart = 0;
    let timerElapsed = 0;
    let lastKeyAt = 0;
    let timerInterval = null;
    const learningSeenByMode = { all: new Set(), merged: new Set() };
    let learningSeenSet = learningSeenByMode.all;
    const REVIEW_STEPS = [2, 5, 10];
    let turn = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function buildOrder() {
      order = shuffle([...activeRoots.keys()]);
      currentIndex = 0;
    }

    function clearReviewState() {
      reviewQueue = [];
      reviewState.clear();
    }

    function removeFromReviewQueue(idx) {
      reviewQueue = reviewQueue.filter((entry) => entry.idx !== idx);
    }

    function scheduleReview(idx, stepIndex) {
      const step = REVIEW_STEPS[stepIndex];
      if (step === undefined) return;
      removeFromReviewQueue(idx);
      const dueAt = turn + step;
      reviewQueue.push({ idx, dueAt });
    }

    function getDueReview() {
      if (!reviewQueue.length) return null;
      let bestIndex = -1;
      let bestDue = Infinity;
      for (let i = 0; i < reviewQueue.length; i += 1) {
        const entry = reviewQueue[i];
        if (entry.dueAt <= turn && entry.dueAt < bestDue) {
          bestDue = entry.dueAt;
          bestIndex = i;
        }
      }
      if (bestIndex === -1) return null;
      const [entry] = reviewQueue.splice(bestIndex, 1);
      return entry.idx;
    }

    function advanceToNextNew() {
      while (currentIndex < order.length) {
        const idx = order[currentIndex];
        if (!completedSet.has(idx) && !reviewState.has(idx)) {
          return;
        }
        currentIndex += 1;
      }
    }

    function pickNextItem() {
      if (practiceMode === 'wrong') {
        if (!wrongSet.size) {
          currentItemIndex = order[0] ?? 0;
          currentIsReview = false;
          return;
        }
        if (reviewEnabled) {
          const dueIdx = getDueReview();
          if (dueIdx !== null) {
            currentItemIndex = dueIdx;
            currentIsReview = true;
            return;
          }
          if (reviewQueue.length > 0) {
            let bestIndex = 0;
            let bestDue = reviewQueue[0].dueAt;
            for (let i = 1; i < reviewQueue.length; i += 1) {
              if (reviewQueue[i].dueAt < bestDue) {
                bestDue = reviewQueue[i].dueAt;
                bestIndex = i;
              }
            }
            const [entry] = reviewQueue.splice(bestIndex, 1);
            currentItemIndex = entry.idx;
            currentIsReview = true;
            return;
          }
        }
        const wrongList = Array.from(wrongSet);
        currentItemIndex = wrongList[Math.floor(Math.random() * wrongList.length)];
        currentIsReview = false;
        return;
      }
      advanceToNextNew();

      if (reviewEnabled) {
        const dueIdx = getDueReview();
        if (dueIdx !== null) {
          currentItemIndex = dueIdx;
          currentIsReview = true;
          return;
        }
      }

      if (currentIndex >= order.length) {
        if (reviewEnabled && reviewQueue.length > 0) {
          let bestIndex = 0;
          let bestDue = reviewQueue[0].dueAt;
          for (let i = 1; i < reviewQueue.length; i += 1) {
            if (reviewQueue[i].dueAt < bestDue) {
              bestDue = reviewQueue[i].dueAt;
              bestIndex = i;
            }
          }
          const [entry] = reviewQueue.splice(bestIndex, 1);
          currentItemIndex = entry.idx;
          currentIsReview = true;
          return;
        }
        if (completedSet.size >= activeRoots.length) {
          handleProgressReset();
          completedSet.clear();
          clearReviewState();
        }
        buildOrder();
        advanceToNextNew();
      }

      if (currentIndex >= order.length) {
        currentItemIndex = order[0] ?? 0;
      } else {
        currentItemIndex = order[currentIndex];
      }
      currentIsReview = false;
    }

    const sizePresets = [
      { rootMin: 18, rootVw: '2.6vw', rootMax: 34, box: 24, boxFont: 14, boxMobile: 20, boxMobileFont: 12 },
      { rootMin: 20, rootVw: '2.9vw', rootMax: 38, box: 27, boxFont: 15, boxMobile: 23, boxMobileFont: 13 },
      { rootMin: 22, rootVw: '3.2vw', rootMax: 40, box: 30, boxFont: 16, boxMobile: 26, boxMobileFont: 14 },
      { rootMin: 24, rootVw: '3.5vw', rootMax: 44, box: 34, boxFont: 18, boxMobile: 30, boxMobileFont: 16 },
      { rootMin: 26, rootVw: '3.8vw', rootMax: 48, box: 38, boxFont: 20, boxMobile: 34, boxMobileFont: 18 },
      { rootMin: 28, rootVw: '4.1vw', rootMax: 52, box: 42, boxFont: 22, boxMobile: 38, boxMobileFont: 20 },
      { rootMin: 30, rootVw: '4.4vw', rootMax: 56, box: 46, boxFont: 24, boxMobile: 42, boxMobileFont: 22 }
    ];
    let sizeIndex = 3;

    function applySize() {
      const preset = sizePresets[sizeIndex];
      const rootStyle = document.documentElement.style;
      rootStyle.setProperty('--root-min', `${preset.rootMin}px`);
      rootStyle.setProperty('--root-vw', preset.rootVw);
      rootStyle.setProperty('--root-max', `${preset.rootMax}px`);
      rootStyle.setProperty('--box-size', `${preset.box}px`);
      rootStyle.setProperty('--box-font', `${preset.boxFont}px`);
      rootStyle.setProperty('--box-size-mobile', `${preset.boxMobile}px`);
      rootStyle.setProperty('--box-font-mobile', `${preset.boxMobileFont}px`);
      if (sizeDownBtn) sizeDownBtn.disabled = sizeIndex === 0;
      if (sizeUpBtn) sizeUpBtn.disabled = sizeIndex === sizePresets.length - 1;
    }

    function normalizeRootLabel(label) {
      return label.replace(/囗\(框\)/g, '囗（框）');
    }

    function normalizeRootItem(item) {
      return { root: normalizeRootLabel(item.root), code: item.code };
    }

    function normalizeMatch(value) {
      return value.replace(/\s+/g, '');
    }

    function buildRootMappings() {
      const mergedToVariants = Array.from({ length: ROOTS_MERGED.length }, () => []);
      const variantToMerged = Array(ROOTS_VARIANTS.length).fill(-1);
      const mergedByCode = new Map();

      ROOTS_MERGED.forEach((item, idx) => {
        const list = mergedByCode.get(item.code) || [];
        list.push({ idx, root: normalizeMatch(item.root) });
        mergedByCode.set(item.code, list);
      });

      ROOTS_VARIANTS.forEach((item, vIdx) => {
        const list = mergedByCode.get(item.code);
        if (!list) return;
        const vRoot = normalizeMatch(item.root);
        const match = list.find((entry) => entry.root.includes(vRoot));
        if (!match) return;
        variantToMerged[vIdx] = match.idx;
        mergedToVariants[match.idx].push(vIdx);
      });

      return { mergedToVariants, variantToMerged };
    }

    function getCompletedIndices() {
      return Array.from(completedSet);
    }

    function getWrongIndices() {
      return Array.from(wrongSet);
    }

    function mapCompletedToMerged(completedVariants) {
      const mergedSet = new Set();
      completedVariants.forEach((vIdx) => {
        const mergedIdx = variantToMerged[vIdx];
        if (mergedIdx >= 0) mergedSet.add(mergedIdx);
      });
      return mergedSet;
    }

    function mapCompletedToVariants(completedMerged) {
      const variantSet = new Set();
      completedMerged.forEach((mIdx) => {
        const list = mergedToVariants[mIdx] || [];
        list.forEach((vIdx) => variantSet.add(vIdx));
      });
      return variantSet;
    }

    function buildOrderWithCompleted(completedSet) {
      const totalItems = activeRoots.length;
      const completed = [];
      completedSet.forEach((idx) => {
        if (idx >= 0 && idx < totalItems) completed.push(idx);
      });
      completed.sort((a, b) => a - b);

      const remaining = [];
      for (let i = 0; i < totalItems; i += 1) {
        if (!completedSet.has(i)) remaining.push(i);
      }
      shuffle(remaining);
      order = completed.concat(remaining);
      currentIndex = completed.length;
    }

    function normalizeInput(value) {
      return value.toLowerCase().replace(/[^a-z]/g, '').slice(0, 2);
    }

    function renderBoxes(value) {
      const padded = value.padEnd(2, '');
      boxEls.forEach((box, idx) => {
        const ch = padded[idx] || '';
        box.textContent = ch;
      });
    }

    function showReveal(code) {
      revealEl.textContent = code;
      revealEl.classList.add('is-show');
    }

    function hideReveal() {
      revealEl.textContent = '';
      revealEl.classList.remove('is-show');
    }

    function registerSeen(idx) {
      if (learningSeenSet.has(idx)) return false;
      learningSeenSet.add(idx);
      return true;
    }

    function applyLearningIntro(item) {
      showReveal(item.code);
    }

    function handleLearningIntro(item) {
      if (!learningMode) return;
      const firstSeen = registerSeen(currentItemIndex);
      if (!firstSeen) return;
      markWrong(currentItemIndex);
      applyLearningIntro(item);
    }

    function handleFollowIntro(item) {
      if (practiceMode !== 'follow') return;
      showReveal(item.code);
    }

    function renderWrongEmpty() {
      rootChar.textContent = '—';
      inputWrap.classList.remove('is-error');
      clearBuffer();
      showReveal('暂无错题');
      locked = true;
    }

    function markWrong(rootIndex) {
      wrongSet.add(rootIndex);
      wrongProgressSet.delete(rootIndex);
      if (reviewEnabled) {
        completedSet.delete(rootIndex);
        const state = reviewState.get(rootIndex) || { stage: 0 };
        state.stage = 0;
        reviewState.set(rootIndex, state);
        removeFromReviewQueue(rootIndex);
      }
      updateProgress();
    }

    function markCorrect(rootIndex) {
      let mastered = false;
      if (!reviewEnabled) {
        completedSet.add(rootIndex);
        mastered = true;
      } else {
        const state = reviewState.get(rootIndex);
        if (!state) {
          completedSet.add(rootIndex);
          mastered = true;
        } else {
          state.stage += 1;
          if (state.stage >= REVIEW_STEPS.length) {
            reviewState.delete(rootIndex);
            removeFromReviewQueue(rootIndex);
            completedSet.add(rootIndex);
            mastered = true;
          } else {
            reviewState.set(rootIndex, state);
            scheduleReview(rootIndex, state.stage - 1);
          }
        }
      }
      updateProgress();
      if (mastered && wrongSet.has(rootIndex)) {
        wrongProgressSet.add(rootIndex);
      }
    }

    function applyWrong(item) {
      updateStats();
      inputWrap.classList.add('is-error');
      showReveal(item.code);
      flashStatus('错误，重打', 'bad');
      shakeInput();
      clearBuffer();
      locked = false;
      codeInput.focus();
    }

    function triggerWrong() {
      if (locked) return;
      const item = activeRoots[currentItemIndex];
      locked = true;
      total += 1;
      markWrong(currentItemIndex);
      applyWrong(item);
    }


    function clearBuffer() {
      buffer = '';
      codeInput.value = '';
      renderBoxes('');
    }

    function setBuffer(value) {
      if (locked) return;
      buffer = normalizeInput(value);
      codeInput.value = buffer;
      renderBoxes(buffer);
      if (statusEl && buffer.length > 0 && statusEl.dataset.state !== 'idle') {
        setIdleStatus();
      }
      if (buffer.length >= 2) {
        submitAnswer(buffer);
      }
    }

    function updateStats() {
      if (progressEl) progressEl.textContent = String(total);
      if (correctEl) correctEl.textContent = String(correct);
      if (accuracyEl) accuracyEl.textContent = total ? `${Math.round((correct / total) * 100)}%` : '0%';
    }

    function updateModeButtons() {
      const isMerged = mode === 'merged';
      if (modeAllBtn) {
        modeAllBtn.classList.toggle('is-active', !isMerged);
        modeAllBtn.setAttribute('aria-pressed', String(!isMerged));
      }
      if (modeMergedBtn) {
        modeMergedBtn.classList.toggle('is-active', isMerged);
        modeMergedBtn.setAttribute('aria-pressed', String(isMerged));
      }
    }

    function updatePracticeButtons() {
      if (reviewOffBtn) {
        const active = practiceMode === 'normal';
        reviewOffBtn.classList.toggle('is-active', active);
        reviewOffBtn.setAttribute('aria-pressed', String(active));
      }
      if (reviewOnBtn) {
        const active = practiceMode === 'review';
        reviewOnBtn.classList.toggle('is-active', active);
        reviewOnBtn.setAttribute('aria-pressed', String(active));
      }
      if (reviewLearnBtn) {
        const active = practiceMode === 'learning';
        reviewLearnBtn.classList.toggle('is-active', active);
        reviewLearnBtn.setAttribute('aria-pressed', String(active));
      }
      if (reviewFollowBtn) {
        const active = practiceMode === 'follow';
        reviewFollowBtn.classList.toggle('is-active', active);
        reviewFollowBtn.setAttribute('aria-pressed', String(active));
      }
      if (reviewWrongBtn) {
        const active = practiceMode === 'wrong';
        reviewWrongBtn.classList.toggle('is-active', active);
        reviewWrongBtn.setAttribute('aria-pressed', String(active));
      }
    }

    function syncPracticeState(nextMode) {
      const nextReviewEnabled = nextMode === 'normal' || nextMode === 'learning' || nextMode === 'wrong';
      const nextLearningMode = nextMode === 'learning';
      document.body.classList.toggle('practice-wrong', nextMode === 'wrong');
      if (reviewEnabled !== nextReviewEnabled) {
        reviewEnabled = nextReviewEnabled;
        if (!reviewEnabled) {
          clearReviewState();
        }
      }
      learningMode = nextLearningMode;
      document.body.classList.toggle('learning-mode', learningMode);
    }

    function setPracticeMode(nextMode) {
      if (nextMode === practiceMode) return;
      practiceMode = nextMode;
      syncPracticeState(nextMode);
      updatePracticeButtons();
      locked = false;
      if (practiceMode === 'wrong') {
        renderQuestion();
      } else {
        renderCurrent();
      }
    }

    function updateUiButtons() {
      if (uiShowBtn) {
        const active = uiMode === 'show';
        uiShowBtn.classList.toggle('is-active', active);
        uiShowBtn.setAttribute('aria-pressed', String(active));
      }
      if (uiHalfBtn) {
        const active = uiMode === 'half';
        uiHalfBtn.classList.toggle('is-active', active);
        uiHalfBtn.setAttribute('aria-pressed', String(active));
      }
      if (uiFullBtn) {
        const active = uiMode === 'full';
        uiFullBtn.classList.toggle('is-active', active);
        uiFullBtn.setAttribute('aria-pressed', String(active));
      }
    }

    function setUiMode(nextMode) {
      uiMode = nextMode;
      document.body.classList.toggle('ui-half', uiMode === 'half');
      document.body.classList.toggle('ui-full', uiMode === 'full');
      updateUiButtons();
    }

    function updateThemeButtons() {
      if (themeLightBtn) {
        const active = schemeMode === 'light';
        themeLightBtn.classList.toggle('is-active', active);
        themeLightBtn.setAttribute('aria-pressed', String(active));
      }
      if (themeDarkBtn) {
        const active = schemeMode === 'dark';
        themeDarkBtn.classList.toggle('is-active', active);
        themeDarkBtn.setAttribute('aria-pressed', String(active));
      }
    }

    const paletteOptions = ['one', 'solarized', 'nord', 'catppuccin', 'gruvbox', 'tokyonight', 'rosepine'];

    function updatePaletteSelect() {
      if (!paletteSelect) return;
      paletteSelect.value = paletteMode;
    }

    function setSchemeMode(nextMode) {
      schemeMode = nextMode;
      document.body.classList.toggle('theme-dark', schemeMode === 'dark');
      updateThemeButtons();
    }

    function getAutoPalette() {
      const bucket = Math.floor((completedSet.size || 0) / 100);
      const index = (autoPaletteBaseIndex + bucket) % paletteOptions.length;
      return paletteOptions[index];
    }

    function handleProgressReset() {
      if (practiceMode !== 'wrong') {
        roundsByMode[mode] = (roundsByMode[mode] || 0) + 1;
      }
      if (paletteMode !== 'auto') return;
      const currentIndex = paletteOptions.indexOf(activePalette);
      autoPaletteBaseIndex = currentIndex >= 0 ? currentIndex : 0;
    }

    function applyPalette(name) {
      activePalette = name;
      paletteOptions.forEach((palette) => {
        document.body.classList.toggle(`theme-${palette}`, palette === name);
      });
    }

    function setPaletteMode(nextMode) {
      paletteMode = nextMode;
      if (paletteMode === 'auto') {
        const currentIndex = paletteOptions.indexOf(activePalette);
        const bucket = Math.floor((completedSet.size || 0) / 100);
        const base = currentIndex - bucket;
        autoPaletteBaseIndex = ((base % paletteOptions.length) + paletteOptions.length) % paletteOptions.length;
      }
      const target = paletteMode === 'auto' ? getAutoPalette() : paletteMode;
      applyPalette(target);
      updatePaletteSelect();
    }

    function maybeAutoPalette() {
      if (paletteMode !== 'auto') return;
      const target = getAutoPalette();
      if (target !== activePalette) {
        applyPalette(target);
      }
      updatePaletteSelect();
    }

    function setMode(nextMode) {
      if (nextMode === mode) return;
      const completed = getCompletedIndices();
      let targetCompleted = new Set();
      if (mode === 'all' && nextMode === 'merged') {
        targetCompleted = mapCompletedToMerged(completed);
      } else if (mode === 'merged' && nextMode === 'all') {
        targetCompleted = mapCompletedToVariants(completed);
      }
      mode = nextMode;
      activeRoots = mode === 'merged' ? ROOTS_MERGED : ROOTS_VARIANTS;
      learningSeenSet = mode === 'merged' ? learningSeenByMode.merged : learningSeenByMode.all;
      wrongSet = mode === 'merged' ? wrongByMode.merged : wrongByMode.all;
      wrongProgressSet = mode === 'merged' ? wrongProgressByMode.merged : wrongProgressByMode.all;
      completedSet.clear();
      targetCompleted.forEach((idx) => completedSet.add(idx));
      clearReviewState();
      buildOrderWithCompleted(targetCompleted);
      renderQuestion();
      updateModeButtons();
    }

    function updateProgress() {
      const totalItems = activeRoots.length || 0;
      const current = totalItems ? completedSet.size : 0;
      if (progressInfoEl) {
        progressInfoEl.textContent = `${current}/${totalItems}`;
      }
      if (wrongProgressInfoEl) {
        let wrongDone = 0;
        if (wrongProgressSet.size) {
          wrongProgressSet.forEach((idx) => {
            if (wrongSet.has(idx)) wrongDone += 1;
          });
        }
        if (practiceMode === 'wrong' && wrongSet.size > 0 && wrongDone >= wrongSet.size) {
          wrongProgressSet.clear();
          wrongDone = 0;
        }
        wrongProgressInfoEl.textContent = `${wrongDone}/${wrongSet.size}`;
      }
      if (roundCrownEl) {
        const rounds = roundsByMode[mode] || 0;
        const crownText = rounds <= 0 ? '' : rounds === 1 ? '👑' : `👑×${rounds}`;
        roundCrownEl.textContent = crownText;
        roundCrownEl.classList.toggle('is-empty', rounds <= 0);
      }
      maybeAutoPalette();
    }

    function formatTimer(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function updateTimerDisplay() {
      if (!timerEl) return;
      const total = timerElapsed + (timerRunning ? Date.now() - timerStart : 0);
      timerEl.textContent = formatTimer(total);
    }

    function pauseTimer() {
      if (!timerRunning) return;
      timerElapsed += Date.now() - timerStart;
      timerRunning = false;
      timerStart = 0;
    }

    function registerActivity() {
      const now = Date.now();
      lastKeyAt = now;
      if (!timerRunning) {
        timerRunning = true;
        timerStart = now;
      }
    }

    function tickTimer() {
      if (timerRunning && Date.now() - lastKeyAt >= TIMER_IDLE_MS) {
        pauseTimer();
      }
      updateTimerDisplay();
    }

    function flashStatus(text, state) {
      if (!statusEl) return;
      statusEl.textContent = text;
      statusEl.dataset.state = state;
    }

    function setIdleStatus() {
      if (!statusEl) return;
      flashStatus('等待输入', 'idle');
    }

    function shakeInput() {
      inputWrap.classList.remove('shake');
      void inputWrap.offsetWidth;
      inputWrap.classList.add('shake');
      setTimeout(() => inputWrap.classList.remove('shake'), 260);
    }

    function renderCurrent(options = {}) {
      if (practiceMode === 'wrong' && wrongSet.size === 0) {
        renderWrongEmpty();
        return;
      }
      locked = false;
      const item = activeRoots[currentItemIndex];
      rootChar.textContent = item.root;
      inputWrap.classList.remove('is-error');
      hideReveal();
      clearBuffer();
      updateProgress();
      if (!options.keepStatus) {
        setIdleStatus();
      }
      handleLearningIntro(item);
      handleFollowIntro(item);
      codeInput.focus();
    }

    function renderQuestion(options = {}) {
      pickNextItem();
      renderCurrent(options);
      turn += 1;
    }

    function submitAnswer(value) {
      if (locked) return;
      const item = activeRoots[currentItemIndex];
      const code = value.slice(0, 2);
      if (code.length < 2) return;

      locked = true;
      total += 1;

      if (code === item.code) {
        correct += 1;
        updateStats();
        markCorrect(currentItemIndex);
        inputWrap.classList.remove('is-error');
        if (practiceMode !== 'follow') {
          hideReveal();
        }
        flashStatus('正确 ✓', 'good');
        if (!currentIsReview && practiceMode !== 'wrong') {
          currentIndex += 1;
        }
        locked = false;
        renderQuestion({ keepStatus: true });
      } else {
        markWrong(currentItemIndex);
        applyWrong(item);
      }
    }

    codeInput.addEventListener('input', (e) => {
      setBuffer(e.target.value);
    });

    codeInput.addEventListener('keydown', (e) => {
      registerActivity();
      if (e.key === 'Enter') {
        submitAnswer(buffer);
        return;
      }
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
        triggerWrong();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (document.activeElement === codeInput) return;
      registerActivity();
      if (locked) return;
      if (e.key === 'Backspace') {
        e.preventDefault();
        setBuffer(buffer.slice(0, -1));
        return;
      }
      if (e.key === 'Enter') {
        e.preventDefault();
        submitAnswer(buffer);
        return;
      }
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
        triggerWrong();
        return;
      }
      if (e.key.length === 1 && /[a-zA-Z]/.test(e.key)) {
        e.preventDefault();
        setBuffer(buffer + e.key);
      }
    });

    document.getElementById('card').addEventListener('click', () => {
      codeInput.focus();
    });

    if (modeAllBtn && modeMergedBtn) {
      modeAllBtn.addEventListener('click', () => setMode('all'));
      modeMergedBtn.addEventListener('click', () => setMode('merged'));
    }

    if (reviewOffBtn && reviewOnBtn && reviewLearnBtn && reviewFollowBtn && reviewWrongBtn) {
      reviewOffBtn.addEventListener('click', () => setPracticeMode('normal'));
      reviewOnBtn.addEventListener('click', () => setPracticeMode('review'));
      reviewLearnBtn.addEventListener('click', () => setPracticeMode('learning'));
      reviewFollowBtn.addEventListener('click', () => setPracticeMode('follow'));
      reviewWrongBtn.addEventListener('click', () => setPracticeMode('wrong'));
    }

    if (uiShowBtn && uiHalfBtn && uiFullBtn) {
      uiShowBtn.addEventListener('click', () => setUiMode('show'));
      uiHalfBtn.addEventListener('click', () => setUiMode('half'));
      uiFullBtn.addEventListener('click', () => setUiMode('full'));
    }

    if (themeLightBtn && themeDarkBtn) {
      themeLightBtn.addEventListener('click', () => setSchemeMode('light'));
      themeDarkBtn.addEventListener('click', () => setSchemeMode('dark'));
    }

    if (paletteSelect) {
      paletteSelect.addEventListener('change', (e) => setPaletteMode(e.target.value));
    }

    if (sizeDownBtn && sizeUpBtn) {
      sizeDownBtn.addEventListener('click', () => {
        sizeIndex = Math.max(0, sizeIndex - 1);
        applySize();
      });
      sizeUpBtn.addEventListener('click', () => {
        sizeIndex = Math.min(sizePresets.length - 1, sizeIndex + 1);
        applySize();
      });
    }
    applySize();
    updateModeButtons();
    syncPracticeState(practiceMode);
    updatePracticeButtons();
    setUiMode(uiMode);
    setPaletteMode(paletteMode);
    setSchemeMode(schemeMode);

    const CURSOR_HIDE_DELAY = 1500;
    let cursorTimer = null;
    let cursorHidden = false;

    function hideCursor() {
      if (cursorHidden) return;
      document.body.classList.add('cursor-hidden');
      cursorHidden = true;
    }

    function showCursor() {
      if (!cursorHidden) return;
      document.body.classList.remove('cursor-hidden');
      cursorHidden = false;
    }

    function resetCursorTimer() {
      showCursor();
      if (cursorTimer) clearTimeout(cursorTimer);
      cursorTimer = setTimeout(hideCursor, CURSOR_HIDE_DELAY);
    }

    document.addEventListener('mousemove', resetCursorTimer, { passive: true });
    document.addEventListener('mousedown', resetCursorTimer, { passive: true });
    document.addEventListener('wheel', resetCursorTimer, { passive: true });
    resetCursorTimer();
    updateTimerDisplay();
    timerInterval = setInterval(tickTimer, TIMER_TICK_MS);

    buildOrder();
    renderQuestion();
  </script>
</body>
</html>
