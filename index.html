<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>虎码字根练习</title>
  <style>
    :root {
      --bg1: #f7efe3;
      --bg2: #efe1c7;
      --ink: #1f2a24;
      --muted: #5b6a60;
      --accent: #1f6f5b;
      --accent-2: #d48b3b;
      --card: #fff8ef;
      --line: rgba(31,42,36,0.12);
      --good: #2e7d32;
      --bad: #b6452b;
      --shadow: 0 20px 50px rgba(31,42,36,0.18);
      --root-min: 24px;
      --root-vw: 3.5vw;
      --root-max: 44px;
      --box-size: 34px;
      --box-font: 18px;
      --box-size-mobile: 30px;
      --box-font-mobile: 16px;
    }

    @font-face {
      font-family: "PdfSimSun";
      src: url("./fonts/BAAAAA_SimSun.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfSimSunExtB";
      src: url("./fonts/HAAAAA_SimSun-ExtB.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfConsolas";
      src: url("./fonts/CAAAAA_Consolas.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfTumanPUA";
      src: url("./fonts/DAAAAA_TumanPUA.ttf") format("truetype");
      font-display: swap;
    }
    @font-face {
      font-family: "PdfLXGWWenKai";
      src: url("./fonts/AAAAAA_LXGWWenKaiGBScreenR.ttf") format("truetype");
      font-display: swap;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 10% -10%, #fff4dc 0%, transparent 60%),
                  radial-gradient(900px 900px at 110% 10%, #f0dcc0 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height: 100vh;
      font-family: "Source Han Sans SC", "Microsoft YaHei", "PingFang SC", "Heiti SC", sans-serif;
      display: grid;
      place-items: center;
      padding: 28px;
    }

    .app {
      width: min(980px, 95vw);
      display: grid;
      gap: 20px;
    }

    header {
      display: grid;
      gap: 6px;
    }
    .title {
      font-family: "PdfLXGWWenKai", "Kaiti SC", "STKaiti", "KaiTi", serif;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: 0.05em;
    }
    .subtitle {
      color: var(--muted);
      font-size: 14px;
    }

    .top-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
    }

    .stat strong {
      color: var(--ink);
    }

    .size-controls {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      margin-left: auto;
    }

    .size-btn {
      border: 1px solid var(--line);
      background: #fffdf8;
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 12px;
      color: var(--ink);
      cursor: pointer;
      transition: border-color 120ms ease, transform 120ms ease, box-shadow 120ms ease;
    }
    .size-btn:hover {
      border-color: rgba(31,111,91,0.45);
      box-shadow: 0 6px 14px rgba(31,111,91,0.12);
      transform: translateY(-1px);
    }
    .size-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .footer {
      color: var(--muted);
      font-size: 12px;
      display: grid;
      gap: 8px;
      z-index: 1;
    }

    .footer-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .footer-hint {
      letter-spacing: 0.04em;
    }

    .footer-row--legal {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    .footer-center {
      justify-self: center;
      text-align: center;
    }

    .footer-right {
      justify-self: end;
    }

    .footer-link {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: color 120ms ease, border-color 120ms ease;
    }

    .footer-link:hover {
      color: #185a4a;
      border-color: rgba(31,111,91,0.5);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 26px 20px 20px;
      min-height: 260px;
      display: grid;
      gap: 4px;
      align-content: center;
      position: relative;
      overflow: hidden;
      animation: floatIn 600ms ease-out;
      justify-items: center;
      text-align: center;
    }

    .card::before {
      content: "";
      position: absolute;
      width: 260px;
      height: 260px;
      background: conic-gradient(from 140deg, rgba(212,139,59,0.12), rgba(31,111,91,0.1), rgba(212,139,59,0.12));
      border-radius: 50%;
      top: -120px;
      right: -120px;
      filter: blur(2px);
      z-index: 0;
    }

    .root-box {
      z-index: 1;
      display: grid;
      gap: 8px;
    }

    .root-label {
      color: var(--muted);
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .root-char {
      font-family: "PdfTumanPUA", "PdfSimSunExtB", "PdfSimSun", serif;
      font-size: clamp(var(--root-min), var(--root-vw), var(--root-max));
      line-height: 1;
      padding: 0;
    }

    .input-area {
      display: grid;
      gap: 10px;
      z-index: 1;
    }

    .input-label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .input-wrap {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 2px;
      cursor: default;
    }
    .input-wrap.is-error .code-box {
      border-color: var(--bad);
      color: var(--bad);
      background: rgba(182,69,43,0.06);
      box-shadow: inset 0 0 0 1px rgba(182,69,43,0.2);
    }

    .code-input {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      background: transparent;
      opacity: 0;
      caret-color: transparent;
      color: transparent;
      cursor: default;
    }

    .code-boxes {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .code-box {
      width: var(--box-size);
      height: var(--box-size);
      border-radius: 8px;
      border: 1px solid var(--line);
      background: #fff;
      display: grid;
      place-items: center;
      font-family: "PdfConsolas", "Consolas", "SFMono-Regular", "Menlo", monospace;
      font-size: var(--box-font);
      font-weight: 600;
      text-transform: lowercase;
      color: var(--ink);
      box-shadow: inset 0 0 0 1px rgba(31,42,36,0.02);
    }

    .reveal {
      min-height: 1em;
      font-family: "PdfConsolas", "Consolas", "SFMono-Regular", "Menlo", monospace;
      font-size: 22px;
      letter-spacing: 0.18em;
      color: var(--bad);
      opacity: 0;
      transform: translateY(-4px);
      transition: opacity 140ms ease, transform 140ms ease;
      z-index: 1;
      line-height: 1;
    }
    .reveal.is-show {
      opacity: 1;
      transform: translateY(0);
    }

    .status {
      font-size: 14px;
      color: var(--muted);
      min-height: 20px;
    }
    .status[data-state="good"] {
      color: var(--good);
    }
    .status[data-state="bad"] {
      color: var(--bad);
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
      z-index: 1;
    }
    .meta strong {
      color: var(--ink);
    }

    .tag {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(212,139,59,0.16);
      color: #8a4f12;
      border: 1px solid rgba(212,139,59,0.35);
      font-size: 12px;
      letter-spacing: 0.04em;
    }

    .shake {
      animation: shake 260ms ease-in-out;
    }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    @media (max-width: 600px) {
      .card { padding: 22px 16px; }
      .top-meta { gap: 10px; }
      .code-box { width: var(--box-size-mobile); height: var(--box-size-mobile); font-size: var(--box-font-mobile); }
      .footer-row--legal {
        grid-template-columns: 1fr;
        justify-items: center;
      }
      .footer-right {
        justify-self: center;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">虎码字根练习</div>
      <div class="top-meta">
        <div class="stat">尝试：<strong id="progress">0</strong></div>
        <div class="stat">正确：<strong id="correct">0</strong></div>
        <div class="stat">准确率：<strong id="accuracy">0%</strong></div>
        <div class="stat">进度：<strong id="progressInfo">0/0</strong></div>
        <div class="status" id="status" data-state="idle">等待输入</div>
        <div class="size-controls">
          <button class="size-btn" id="sizeDown" type="button" aria-label="缩小">小</button>
          <button class="size-btn" id="sizeUp" type="button" aria-label="放大">大</button>
        </div>
      </div>
    </header>

    <section class="card" id="card">
      <div class="root-char" id="rootChar">?</div>
      <div class="reveal" id="reveal" aria-live="polite"></div>

      <div class="input-wrap" id="inputWrap">
        <input class="code-input" id="codeInput" type="text" inputmode="latin" autocomplete="off" autocapitalize="off" spellcheck="false" maxlength="2" />
        <div class="code-boxes" id="codeBoxes" aria-hidden="true">
          <div class="code-box" data-pos="0"></div>
          <div class="code-box" data-pos="1"></div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-row footer-row--legal">
        <span aria-hidden="true"></span>
        <span class="footer-center">© 2026 虎码字根练习　备案号：待填写</span>
        <span class="footer-right"><a class="footer-link" href="https://www.tiger-code.com/" target="_blank" rel="noopener noreferrer">虎码</a></span>
      </div>
    </footer>
  </div>

  <script>
    const ROOTS = [{"root": "疒", "code": "ab"}, {"root": "丁", "code": "ad"}, {"root": "㇆", "code": "ae"}, {"root": "乛", "code": "ae"}, {"root": "", "code": "ae"}, {"root": "⺄", "code": "ae"}, {"root": "㇗", "code": "ae"}, {"root": "乚", "code": "ae"}, {"root": "ヿ", "code": "ae"}, {"root": "ㄋ", "code": "ae"}, {"root": "ㄅ", "code": "ae"}, {"root": "", "code": "ae"}, {"root": "丰", "code": "af"}, {"root": "", "code": "af"}, {"root": "龶", "code": "af"}, {"root": "", "code": "af"}, {"root": "缶", "code": "af"}, {"root": "", "code": "af"}, {"root": "鬼", "code": "ag"}, {"root": "乙", "code": "ai"}, {"root": "六", "code": "al"}, {"root": "耒", "code": "al"}, {"root": "门", "code": "am"}, {"root": "皿", "code": "am"}, {"root": "片", "code": "ap"}, {"root": "爿", "code": "ap"}, {"root": "丬", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "", "code": "ap"}, {"root": "舌", "code": "as"}, {"root": "", "code": "as"}, {"root": "未", "code": "aw"}, {"root": "弓", "code": "bg"}, {"root": "乂", "code": "bi"}, {"root": "㐅", "code": "bi"}, {"root": "", "code": "bi"}, {"root": "彐", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "彑", "code": "bj"}, {"root": "", "code": "bj"}, {"root": "", "code": "bk"}, {"root": "", "code": "bk"}, {"root": "卵", "code": "bl"}, {"root": "卯", "code": "bm"}, {"root": "", "code": "bm"}, {"root": "面", "code": "bm"}, {"root": "女", "code": "bn"}, {"root": "氏", "code": "bs"}, {"root": "聿", "code": "bv"}, {"root": "肀", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "", "code": "bv"}, {"root": "云", "code": "by"}, {"root": "", "code": "by"}, {"root": "不", "code": "cb"}, {"root": "虫", "code": "cc"}, {"root": "", "code": "cc"}, {"root": "飞", "code": "cf"}, {"root": "古", "code": "cg"}, {"root": "火", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "", "code": "ch"}, {"root": "灬", "code": "ch"}, {"root": "支", "code": "ci"}, {"root": "及", "code": "cj"}, {"root": "尸", "code": "cs"}, {"root": "", "code": "cs"}, {"root": "", "code": "cs"}, {"root": "业", "code": "cy"}, {"root": "口", "code": "dk"}, {"root": "〇", "code": "dk"}, {"root": "里", "code": "dl"}, {"root": "民", "code": "dm"}, {"root": "黾", "code": "dm"}, {"root": "无", "code": "du"}, {"root": "旡", "code": "du"}, {"root": "由", "code": "dy"}, {"root": "干", "code": "eg"}, {"root": "见", "code": "ej"}, {"root": "木", "code": "em"}, {"root": "朩", "code": "em"}, {"root": "欠", "code": "eq"}, {"root": "彡", "code": "es"}, {"root": "", "code": "es"}, {"root": "𠂉", "code": "et"}, {"root": "穴", "code": "ex"}, {"root": "", "code": "ex"}, {"root": "也", "code": "ey"}, {"root": "㡀", "code": "fb"}, {"root": "辰", "code": "fc"}, {"root": "骨", "code": "fg"}, {"root": "冎", "code": "fg"}, {"root": "一", "code": "fi"}, {"root": "㇀", "code": "fi"}, {"root": "且", "code": "fq"}, {"root": "示", "code": "fs"}, {"root": "礻", "code": "fs"}, {"root": "亡", "code": "fw"}, {"root": "亾", "code": "fw"}, {"root": "歹", "code": "gd"}, {"root": "歺", "code": "gd"}, {"root": "", "code": "gd"}, {"root": "高", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "", "code": "gg"}, {"root": "句", "code": "gj"}, {"root": "丨", "code": "gs"}, {"root": "亅", "code": "gs"}, {"root": "士", "code": "gs"}, {"root": "土", "code": "gt"}, {"root": "韦", "code": "gw"}, {"root": "羊", "code": "gy"}, {"root": "⺷", "code": "gy"}, {"root": "⺶", "code": "gy"}, {"root": "", "code": "gy"}, {"root": "芈", "code": "gy"}, {"root": "八", "code": "hb"}, {"root": "丷", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "䒑", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "癶", "code": "hb"}, {"root": "", "code": "hb"}, {"root": "夫", "code": "hf"}, {"root": "谷", "code": "hg"}, {"root": "", "code": "hg"}, {"root": "子", "code": "hi"}, {"root": "夂", "code": "hi"}, {"root": "夊", "code": "hi"}, {"root": "", "code": "hi"}, {"root": "攵", "code": "hp"}, {"root": "攴", "code": "hp"}, {"root": "壴", "code": "hu"}, {"root": "", "code": "hu"}, {"root": "心", "code": "hx"}, {"root": "忄", "code": "hx"}, {"root": "⺗", "code": "hx"}, {"root": "册", "code": "ic"}, {"root": "", "code": "ic"}, {"root": "", "code": "ic"}, {"root": "丶", "code": "id"}, {"root": "㇏", "code": "id"}, {"root": "艮", "code": "ig"}, {"root": "", "code": "ig"}, {"root": "丩", "code": "ij"}, {"root": "立", "code": "il"}, {"root": "", "code": "il"}, {"root": "舟", "code": "io"}, {"root": "糸", "code": "is"}, {"root": "纟", "code": "is"}, {"root": "予", "code": "iv"}, {"root": "乡", "code": "ix"}, {"root": "幺", "code": "iy"}, {"root": "斗", "code": "jd"}, {"root": "亼", "code": "ji"}, {"root": "亽", "code": "ji"}, {"root": "仑", "code": "jl"}, {"root": "侖", "code": "jl"}, {"root": "人", "code": "jr"}, {"root": "亻", "code": "jr"}, {"root": "豕", "code": "js"}, {"root": "", "code": "js"}, {"root": "入", "code": "ju"}, {"root": "寸", "code": "kc"}, {"root": "亥", "code": "kh"}, {"root": "㠯", "code": "ki"}, {"root": "九", "code": "kj"}, {"root": "母", "code": "km"}, {"root": "水", "code": "ks"}, {"root": "氵", "code": "ks"}, {"root": "⺍", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "氺", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "厶", "code": "ks"}, {"root": "龴", "code": "ks"}, {"root": "", "code": "ks"}, {"root": "毋", "code": "ku"}, {"root": "毌", "code": "ku"}, {"root": "艹", "code": "lc"}, {"root": "廾", "code": "lc"}, {"root": "丌", "code": "lc"}, {"root": "艸", "code": "lc"}, {"root": "齿", "code": "lc"}, {"root": "而", "code": "le"}, {"root": "方", "code": "lf"}, {"root": "廿", "code": "ln"}, {"root": "龷", "code": "ln"}, {"root": "千", "code": "lq"}, {"root": "生", "code": "ls"}, {"root": "卅", "code": "ls"}, {"root": "", "code": "ls"}, {"root": "夕", "code": "lx"}, {"root": "卌", "code": "lx"}, {"root": "牙", "code": "ly"}, {"root": "巴", "code": "mb"}, {"root": "大", "code": "md"}, {"root": "二", "code": "me"}, {"root": "光", "code": "mg"}, {"root": "", "code": "mg"}, {"root": "户", "code": "mh"}, {"root": "", "code": "mh"}, {"root": "豸", "code": "mi"}, {"root": "冂", "code": "mk"}, {"root": "凵", "code": "mk"}, {"root": "⺆", "code": "mk"}, {"root": "", "code": "mk"}, {"root": "", "code": "mk"}, {"root": "两", "code": "ml"}, {"root": "犬", "code": "mq"}, {"root": "犭", "code": "mq"}, {"root": "石", "code": "ms"}, {"root": "甫", "code": "nf"}, {"root": "鬲", "code": "ng"}, {"root": "黄", "code": "nh"}, {"root": "勹", "code": "nk"}, {"root": "匚", "code": "nk"}, {"root": "", "code": "nk"}, {"root": "コ", "code": "nk"}, {"root": "马", "code": "nm"}, {"root": "十", "code": "ns"}, {"root": "𠂇", "code": "ns"}, {"root": "", "code": "ns"}, {"root": "戊", "code": "nu"}, {"root": "", "code": "nu"}, {"root": "戉", "code": "nu"}, {"root": "王", "code": "nw"}, {"root": "辛", "code": "nx"}, {"root": "贝", "code": "ob"}, {"root": "川", "code": "oc"}, {"root": "", "code": "oc"}, {"root": "", "code": "oc"}, {"root": "巛", "code": "oc"}, {"root": "巜", "code": "oc"}, {"root": "自", "code": "oi"}, {"root": "几", "code": "oj"}, {"root": "⺇", "code": "oj"}, {"root": "", "code": "oj"}, {"root": "日", "code": "or"}, {"root": "曰", "code": "or"}, {"root": "⺜", "code": "or"}, {"root": "", "code": "or"}, {"root": "矢", "code": "os"}, {"root": "尤", "code": "oy"}, {"root": "尢", "code": "oy"}, {"root": "长", "code": "pc"}, {"root": "镸", "code": "pc"}, {"root": "刀", "code": "pd"}, {"root": "〢", "code": "pd"}, {"root": "刂", "code": "pd"}, {"root": "リ", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "", "code": "pd"}, {"root": "儿", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "", "code": "pe"}, {"root": "戈", "code": "pg"}, {"root": "", "code": "pg"}, {"root": "黑", "code": "ph"}, {"root": "", "code": "ph"}, {"root": "弋", "code": "pi"}, {"root": "臼", "code": "pj"}, {"root": "", "code": "pj"}, {"root": "米", "code": "pm"}, {"root": "", "code": "pm"}, {"root": "鼠", "code": "ps"}, {"root": "", "code": "ps"}, {"root": "足", "code": "pu"}, {"root": "⻊", "code": "pu"}, {"root": "行", "code": "px"}, {"root": "走", "code": "pz"}, {"root": "臣", "code": "qc"}, {"root": "", "code": "qc"}, {"root": "耳", "code": "qe"}, {"root": "井", "code": "qj"}, {"root": "", "code": "qj"}, {"root": "老", "code": "ql"}, {"root": "耂", "code": "ql"}, {"root": "目", "code": "qm"}, {"root": "", "code": "qm"}, {"root": "牛", "code": "qn"}, {"root": "牜", "code": "qn"}, {"root": "⺧", "code": "qn"}, {"root": "齐", "code": "qq"}, {"root": "食", "code": "qs"}, {"root": "饣", "code": "qs"}, {"root": "田", "code": "qt"}, {"root": "非", "code": "rf"}, {"root": "之", "code": "ri"}, {"root": "巾", "code": "rj"}, {"root": "囗（框）", "code": "rk"}, {"root": "了", "code": "rl"}, {"root": "皮", "code": "rp"}, {"root": "七", "code": "rq"}, {"root": "", "code": "rq"}, {"root": "", "code": "rq"}, {"root": "殳", "code": "rs"}, {"root": "竹", "code": "ru"}, {"root": "⺮", "code": "ru"}, {"root": "", "code": "ru"}, {"root": "瓦", "code": "rw"}, {"root": "又", "code": "ry"}, {"root": "ス", "code": "ry"}, {"root": "屮", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "", "code": "sc"}, {"root": "各", "code": "sg"}, {"root": "止", "code": "si"}, {"root": "", "code": "si"}, {"root": "", "code": "si"}, {"root": "龰", "code": "si"}, {"root": "甲", "code": "sj"}, {"root": "力", "code": "sl"}, {"root": "尚", "code": "ss"}, {"root": "", "code": "ss"}, {"root": "龸", "code": "ss"}, {"root": "言", "code": "sy"}, {"root": "讠", "code": "sy"}, {"root": "阝", "code": "te"}, {"root": "弗", "code": "tf"}, {"root": "𢎨", "code": "tf"}, {"root": "𠂔", "code": "tf"}, {"root": "革", "code": "tg"}, {"root": "衣", "code": "ti"}, {"root": "衤", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "", "code": "ti"}, {"root": "斤", "code": "tj"}, {"root": "", "code": "tj"}, {"root": "龙", "code": "tl"}, {"root": "丿", "code": "tp"}, {"root": "㇒", "code": "tp"}, {"root": "疋", "code": "ts"}, {"root": "𤴓", "code": "ts"}, {"root": "⺪", "code": "ts"}, {"root": "三", "code": "ts"}, {"root": "雨", "code": "tv"}, {"root": "⻗", "code": "tv"}, {"root": "用", "code": "ty"}, {"root": "", "code": "ty"}, {"root": "白", "code": "ub"}, {"root": "辶", "code": "uc"}, {"root": "工", "code": "ug"}, {"root": "隹", "code": "ui"}, {"root": "手", "code": "us"}, {"root": "扌", "code": "us"}, {"root": "龵", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "", "code": "us"}, {"root": "廴", "code": "uy"}, {"root": "匕", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "", "code": "vb"}, {"root": "已", "code": "vi"}, {"root": "己", "code": "vj"}, {"root": "", "code": "vj"}, {"root": "㐄", "code": "vk"}, {"root": "", "code": "vk"}, {"root": "毛", "code": "vm"}, {"root": "乃", "code": "vn"}, {"root": "", "code": "vn"}, {"root": "气", "code": "vq"}, {"root": "禸", "code": "vr"}, {"root": "⽱", "code": "vr"}, {"root": "山", "code": "vs"}, {"root": "巳", "code": "vs"}, {"root": "文", "code": "vw"}, {"root": "西", "code": "vx"}, {"root": "覀", "code": "vx"}, {"root": "月", "code": "vy"}, {"root": "⺝", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "", "code": "vy"}, {"root": "乍", "code": "wa"}, {"root": "冫", "code": "wb"}, {"root": "", "code": "wb"}, {"root": "⺀", "code": "wb"}, {"root": "彳", "code": "wc"}, {"root": "亍", "code": "wc"}, {"root": "宀", "code": "wg"}, {"root": "冖", "code": "wg"}, {"root": "龟", "code": "wg"}, {"root": "兔", "code": "wt"}, {"root": "", "code": "wt"}, {"root": "五", "code": "wu"}, {"root": "鱼", "code": "wv"}, {"root": "𩵋", "code": "wv"}, {"root": "象", "code": "wx"}, {"root": "页", "code": "wy"}, {"root": "頁", "code": "wy"}, {"root": "", "code": "wy"}, {"root": "", "code": "wy"}, {"root": "厂", "code": "xc"}, {"root": "⺁", "code": "xc"}, {"root": "⺈", "code": "xd"}, {"root": "", "code": "xd"}, {"root": "", "code": "xd"}, {"root": "广", "code": "xg"}, {"root": "禾", "code": "xh"}, {"root": "", "code": "xh"}, {"root": "鹿", "code": "xl"}, {"root": "鸟", "code": "xn"}, {"root": "", "code": "xn"}, {"root": "束", "code": "xs"}, {"root": "乌", "code": "xu"}, {"root": "音", "code": "xy"}, {"root": "爪", "code": "ya"}, {"root": "爫", "code": "ya"}, {"root": "卜", "code": "yb"}, {"root": "⺊", "code": "yb"}, {"root": "车", "code": "yc"}, {"root": "", "code": "yc"}, {"root": "車", "code": "yc"}, {"root": "瓜", "code": "yg"}, {"root": "至", "code": "yi"}, {"root": "曲", "code": "yq"}, {"root": "四", "code": "ys"}, {"root": "罒", "code": "ys"}, {"root": "小", "code": "yx"}, {"root": "⺌", "code": "yx"}, {"root": "", "code": "yx"}, {"root": "𡭔", "code": "yx"}, {"root": "酉", "code": "yy"}, {"root": "豆", "code": "zd"}, {"root": "甘", "code": "zg"}, {"root": "", "code": "zg"}, {"root": "虎", "code": "zh"}, {"root": "虍", "code": "zh"}, {"root": "金", "code": "zj"}, {"root": "钅", "code": "zj"}, {"root": "", "code": "zj"}, {"root": "卩", "code": "zj"}, {"root": "ㄗ", "code": "zj"}, {"root": "⺋", "code": "zj"}, {"root": "", "code": "zj"}, {"root": "可", "code": "zk"}, {"root": "", "code": "zk"}, {"root": "麻", "code": "zm"}, {"root": "身", "code": "zs"}, {"root": "㐆", "code": "zs"}, {"root": "亠", "code": "zt"}, {"root": "羽", "code": "zv"}, {"root": "习", "code": "zx"}];

    const rootChar = document.getElementById('rootChar');
    const codeInput = document.getElementById('codeInput');
    const inputWrap = document.getElementById('inputWrap');
    const boxEls = Array.from(document.querySelectorAll('.code-box'));
    const revealEl = document.getElementById('reveal');
    const statusEl = document.getElementById('status');
    const progressEl = document.getElementById('progress');
    const correctEl = document.getElementById('correct');
    const accuracyEl = document.getElementById('accuracy');
    const progressInfoEl = document.getElementById('progressInfo');
    const sizeDownBtn = document.getElementById('sizeDown');
    const sizeUpBtn = document.getElementById('sizeUp');

    let order = [];
    let currentIndex = 0;
    let total = 0;
    let correct = 0;
    let locked = false;
    let buffer = '';

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function buildOrder() {
      order = shuffle([...ROOTS.keys()]);
      currentIndex = 0;
    }

    const sizePresets = [
      { rootMin: 22, rootVw: '3.25vw', rootMax: 40, box: 30, boxFont: 16, boxMobile: 26, boxMobileFont: 14 },
      { rootMin: 24, rootVw: '3.5vw', rootMax: 44, box: 34, boxFont: 18, boxMobile: 30, boxMobileFont: 16 },
      { rootMin: 26, rootVw: '4vw', rootMax: 48, box: 38, boxFont: 20, boxMobile: 34, boxMobileFont: 18 }
    ];
    let sizeIndex = 1;

    function applySize() {
      const preset = sizePresets[sizeIndex];
      const rootStyle = document.documentElement.style;
      rootStyle.setProperty('--root-min', `${preset.rootMin}px`);
      rootStyle.setProperty('--root-vw', preset.rootVw);
      rootStyle.setProperty('--root-max', `${preset.rootMax}px`);
      rootStyle.setProperty('--box-size', `${preset.box}px`);
      rootStyle.setProperty('--box-font', `${preset.boxFont}px`);
      rootStyle.setProperty('--box-size-mobile', `${preset.boxMobile}px`);
      rootStyle.setProperty('--box-font-mobile', `${preset.boxMobileFont}px`);
      if (sizeDownBtn) sizeDownBtn.disabled = sizeIndex === 0;
      if (sizeUpBtn) sizeUpBtn.disabled = sizeIndex === sizePresets.length - 1;
    }

    function normalizeInput(value) {
      return value.toLowerCase().replace(/[^a-z]/g, '').slice(0, 2);
    }

    function renderBoxes(value) {
      const padded = value.padEnd(2, '');
      boxEls.forEach((box, idx) => {
        const ch = padded[idx] || '';
        box.textContent = ch;
      });
    }

    function showReveal(code) {
      revealEl.textContent = code;
      revealEl.classList.add('is-show');
    }

    function hideReveal() {
      revealEl.textContent = '';
      revealEl.classList.remove('is-show');
    }

    function applyWrong(item) {
      updateStats();
      inputWrap.classList.add('is-error');
      showReveal(item.code);
      flashStatus('错误，重打', 'bad');
      shakeInput();
      clearBuffer();
      locked = false;
      codeInput.focus();
    }

    function triggerWrong() {
      if (locked) return;
      const item = ROOTS[order[currentIndex]];
      locked = true;
      total += 1;
      applyWrong(item);
    }


    function clearBuffer() {
      buffer = '';
      codeInput.value = '';
      renderBoxes('');
    }

    function setBuffer(value) {
      if (locked) return;
      buffer = normalizeInput(value);
      codeInput.value = buffer;
      renderBoxes(buffer);
      if (buffer.length > 0 && statusEl.dataset.state !== 'idle') {
        setIdleStatus();
      }
      if (buffer.length >= 2) {
        submitAnswer(buffer);
      }
    }

    function updateStats() {
      progressEl.textContent = String(total);
      correctEl.textContent = String(correct);
      accuracyEl.textContent = total ? `${Math.round((correct / total) * 100)}%` : '0%';
    }

    function updateProgress() {
      if (!progressInfoEl) return;
      const totalItems = order.length || 0;
      const current = totalItems ? (currentIndex + 1) : 0;
      progressInfoEl.textContent = `${current}/${totalItems}`;
    }

    function flashStatus(text, state) {
      statusEl.textContent = text;
      statusEl.dataset.state = state;
    }

    function setIdleStatus() {
      flashStatus('等待输入', 'idle');
    }

    function shakeInput() {
      inputWrap.classList.remove('shake');
      void inputWrap.offsetWidth;
      inputWrap.classList.add('shake');
      setTimeout(() => inputWrap.classList.remove('shake'), 260);
    }

    function renderQuestion(options = {}) {
      if (currentIndex >= order.length) {
        buildOrder();
      }
      const item = ROOTS[order[currentIndex]];
      rootChar.textContent = item.root;
      inputWrap.classList.remove('is-error');
      hideReveal();
      clearBuffer();
      updateProgress();
      if (!options.keepStatus) {
        setIdleStatus();
      }
      codeInput.focus();
    }

    function submitAnswer(value) {
      if (locked) return;
      const item = ROOTS[order[currentIndex]];
      const code = value.slice(0, 2);
      if (code.length < 2) return;

      locked = true;
      total += 1;

      if (code === item.code) {
        correct += 1;
        updateStats();
        inputWrap.classList.remove('is-error');
        hideReveal();
        flashStatus('正确 ✓', 'good');
        currentIndex += 1;
        locked = false;
        renderQuestion({ keepStatus: true });
      } else {
        applyWrong(item);
      }
    }

    codeInput.addEventListener('input', (e) => {
      setBuffer(e.target.value);
    });

    codeInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        submitAnswer(buffer);
        return;
      }
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
        triggerWrong();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (document.activeElement === codeInput) return;
      if (locked) return;
      if (e.key === 'Backspace') {
        e.preventDefault();
        setBuffer(buffer.slice(0, -1));
        return;
      }
      if (e.key === 'Enter') {
        e.preventDefault();
        submitAnswer(buffer);
        return;
      }
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
        triggerWrong();
        return;
      }
      if (e.key.length === 1 && /[a-zA-Z]/.test(e.key)) {
        e.preventDefault();
        setBuffer(buffer + e.key);
      }
    });

    document.getElementById('card').addEventListener('click', () => {
      codeInput.focus();
    });

    if (sizeDownBtn && sizeUpBtn) {
      sizeDownBtn.addEventListener('click', () => {
        sizeIndex = Math.max(0, sizeIndex - 1);
        applySize();
      });
      sizeUpBtn.addEventListener('click', () => {
        sizeIndex = Math.min(sizePresets.length - 1, sizeIndex + 1);
        applySize();
      });
    }
    applySize();

    buildOrder();
    renderQuestion();
  </script>
</body>
</html>
